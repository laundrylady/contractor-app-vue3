import{_ as w}from"./GlobalNotifications.42557f9a.js";import{Q as A}from"./QSelect.0342b451.js";import{A as q,i as U,r as f,B as M,o as T,m as a,K as D,L as _,l as o,N as F,U as b,n,R as j,q as u,F as N,b1 as Q,y as g,M as J,S,ae as L,Q as R,ai as m}from"./index.7da93179.js";import{Q as H}from"./QEditor.029e164b.js";import{u as I,r as v}from"./index.esm.0811bb15.js";import{u as K}from"./use-quasar.41dfdbfa.js";import{a as h}from"./axios.07c7c7d9.js";import{u as k}from"./debug.9f3fb657.js";import{d as z}from"./help.4068c5a1.js";import"./QToolbarTitle.8a26e038.js";import"./QTable.01150601.js";import"./QList.709f4980.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./ClosePopup.42f5b568.js";import"./QBadge.d2d220ed.js";import"./QItem.642560fa.js";import"./rtl.ba9e3bff.js";import"./QMenu.00781621.js";import"./format.3e32b8d9.js";import"./QBtnGroup.17d5a1bd.js";const G=u("div",{class:"text-h6 q-mb-md"},"Send Notification",-1),P={key:0,class:"q-pa-md"},W={key:1,class:"bg-positive text-white q-pa-md q-mt-md"},X=q({__name:"SendNotificationOrder",props:{notifiable_id:null,order:null},setup(s){const d=s,c=K(),x=U("bus"),r=f(),C=f(),$=f(),y={notification_template_id:null,notifiable_id:d.notifiable_id,notifiable_type:"Order",html:"",subject:null},i=M(y),V=f(),p=I({notifiable_id:{required:v},notifiable_type:{required:v},subject:{required:v},html:{required:v}},i),B=()=>{r.value=null,Object.assign(i,JSON.parse(JSON.stringify(y)))},E=()=>{if(!i.notification_template_id){i.subject=null,i.html="";return}h.get(`/notificationtemplate/${i.notification_template_id}`).then(l=>{l.data.content?(i.html=l.data.content,i.subject=l.data.subject):C.value=""})},O=()=>{c.loading.show({message:"Queuing emails for sending..."}),h.post("/notification/sendorder",i).then(l=>{z("positive","Emails queued for sending"),c.loading.hide(),r.value=l.data,x.emit("getNotifications"),i.subject=null,i.html=""}).catch(l=>{k(l),c.loading.hide()})};return T(()=>{const l=[];d.order.team.users&&(d.order.team.users.forEach(e=>{e.email_notifications&&l.push(e)}),V.value=l),h.get("/notificationtemplate/index").then(e=>{$.value=[{value:null,label:"Select a template"}].concat(e.data.map(t=>({value:t.id,label:t.name})))}).catch(e=>{k(e)})}),(l,e)=>(a(),D(R,null,{default:_(()=>[o(J,null,{default:_(()=>[G,o(A,{modelValue:i.notification_template_id,"onUpdate:modelValue":[e[0]||(e[0]=t=>i.notification_template_id=t),e[1]||(e[1]=t=>E())],options:$.value,"emit-value":"","map-options":"",label:"Template",outlined:"",class:"q-mb-md"},null,8,["modelValue","options"]),o(F,{modelValue:i.subject,"onUpdate:modelValue":e[2]||(e[2]=t=>i.subject=t),label:"Subject",error:b(p).subject.$invalid,onBlur:e[3]||(e[3]=t=>b(p).subject.$touch())},null,8,["modelValue","error"]),o(H,{modelValue:i.html,"onUpdate:modelValue":e[4]||(e[4]=t=>i.html=t),label:"Content",error:b(p).html.$invalid},null,8,["modelValue","error"]),!r.value||!r.value.length?(a(),n("div",P,[j(" An email will be sent to the following members: "),u("ul",null,[(a(!0),n(N,null,Q(V.value,t=>(a(),n("li",{key:t.id},m(t.fullname)+" ("+m(t.email)+") ",1))),128))])])):g("",!0),r.value?(a(),n("div",W,[j(" Email sent to: "),(a(!0),n(N,null,Q(r.value,t=>(a(),n("div",{key:t.id},[u("strong",null,m(t.user.fullname)+" ("+m(t.user.email)+")",1)]))),128))])):g("",!0)]),_:1}),o(L,{align:"right"},{default:_(()=>[o(S,{onClick:e[5]||(e[5]=t=>B()),color:"secondary",label:"Reset"}),o(S,{onClick:e[6]||(e[6]=t=>O()),disable:b(p).$invalid,label:"Send",color:"primary"},null,8,["disable"])]),_:1})]),_:1}))}}),Y={key:0},Z=u("div",{class:"text-h6"},"Email Activities",-1),je=q({__name:"OrderNotifications",props:{model:null},setup(s){return(d,c)=>s.model.id?(a(),n("div",Y,[Z,u("p",null,"Send an Email or view the history for this "+m(d.$t("order.name"))+".",1),o(X,{order:s.model,notifiable_id:s.model.id,class:"q-mb-lg"},null,8,["order","notifiable_id"]),o(w,{notifiable_id:s.model.id,notifiable_type:"Order"},null,8,["notifiable_id"])])):g("",!0)}});export{je as default};
