import{A as E,r as p,B as J,i as j,o as H,E as W,m as i,K as q,L as t,l as a,R as v,ai as k,G as O,S as Q,ag as Z,M as ee,q as h,U as n,n as m,y,b3 as I,F as z,b1 as ae,b2 as te,ae as le,Q as G,aj as oe,J as re,t as se,O as N,N as de}from"./index.7da93179.js";import{a as ie,Q as R}from"./QBreadcrumbs.96094532.js";import{Q as K}from"./QSpace.2d911a61.js";import{Q as ne}from"./QHeader.9f36f572.js";import{Q as ue,a as b}from"./QTable.01150601.js";import{a as A,Q as x}from"./QItem.642560fa.js";import{Q as ce}from"./QList.709f4980.js";import{Q as me}from"./QMenu.00781621.js";import{Q as pe}from"./QPage.e25f8b02.js";import{Q as _e,a as fe}from"./QLayout.bec178d3.js";import{C as S}from"./ClosePopup.42f5b568.js";import{a as L}from"./axios.07c7c7d9.js";import{Q as ge,a as be}from"./QToolbarTitle.8a26e038.js";import{Q as D}from"./QSelect.0342b451.js";import{u as ve,r as B}from"./index.esm.0811bb15.js";import{u as M}from"./debug.9f3fb657.js";import{e as ke,h as ye,d as he,u as we,o as F,s as Ve,r as Qe,j as $e,c as Pe,a as qe}from"./help.4068c5a1.js";import{p as Ce}from"./helpers.84dd3d7a.js";import{u as X}from"./vue-i18n.runtime.esm-bundler.dc0339a7.js";import{_ as Be}from"./DateField.87b7069c.js";import{_ as Oe,a as Se}from"./OrderContractorManagement.783fe33b.js";import{_ as Ue}from"./StatusTag.c958dd1f.js";import{_ as Ne}from"./UserAvatar.41db8b9e.js";import"./QResizeObserver.66f1c4a6.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./rtl.ba9e3bff.js";import"./format.3e32b8d9.js";import"./use-quasar.41dfdbfa.js";import"./QBadge.d2d220ed.js";const De={class:"row q-col-gutter-md q-mb-md"},Le={key:0,class:"row q-col-gutter-md"},Me={key:1,class:"q-mt-md"},Te=h("div",{class:"text-h6"},"Products",-1),Ie={class:"q-mr-sm"},Re={key:0},Ae={key:2,class:"q-mt-md"},xe={class:"q-mt-md"},Fe=E({__name:"OrderCreate",setup(Y){const c=p(!1),u=p(!1),w=p(),V={team_id:null,contractor_user_id:null,scheduled_pickup_date:null,scheduled_pickup_time:null,special_instructions:null,status:"confirmed",recurring_order:!1,recurring:null,products:[],productcategories:[]},l=J(JSON.parse(JSON.stringify(V))),_=p(!1),$=j("bus"),d=X(),f=ve({team_id:{required:B},scheduled_pickup_date:{required:B},scheduled_pickup_time:{required:B},status:{required:B}},l),U=()=>{l.productcategories.forEach(r=>{r.active=u.value})},s=()=>{L.post("/order",l).then(()=>{he("positive",`${d.t("order.name")} created`),$.emit("orderLoadMore"),c.value=!1,_.value=!1}).catch(r=>{M(r)})};return H(async()=>{$.on("newOrder",async()=>{Object.assign(l,JSON.parse(JSON.stringify(V))),w.value=await Ce();for(const r of w.value)l.productcategories.push({product_category_id:r.value,active:!1});c.value=!0,u.value=!1})}),W(()=>{$.off("newOrder")}),(r,o)=>(i(),q(oe,{modelValue:c.value,"onUpdate:modelValue":o[10]||(o[10]=e=>c.value=e)},{default:t(()=>[a(G,{class:"modal"},{default:t(()=>[a(ge,null,{default:t(()=>[a(be,null,{default:t(()=>[v(k(r.$t("order.create")),1)]),_:1}),a(K),O(a(Q,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])]),_:1}),a(Z),a(ee,null,{default:t(()=>[h("div",De,[a(Oe,{modelValue:l.team_id,"onUpdate:modelValue":o[0]||(o[0]=e=>l.team_id=e),label:r.$t("team.name"),status:"active",class:"col-xs-12 col-sm-9",error:n(f).team_id.$invalid},null,8,["modelValue","label","error"]),a(D,{modelValue:l.status,"onUpdate:modelValue":o[1]||(o[1]=e=>l.status=e),label:r.$t("order.status"),error:n(f).status.$invalid,"map-options":"",options:n(ke),"emit-value":"",class:"col-xs-12 col-sm-3"},null,8,["modelValue","label","error","options"])]),l.team_id?(i(),m("div",Le,[a(Be,{modelValue:l.scheduled_pickup_date,"onUpdate:modelValue":o[2]||(o[2]=e=>l.scheduled_pickup_date=e),label:r.$t("order.scheduledPickupDate"),invalid:n(f).scheduled_pickup_date.$invalid,class:"col-xs-12 col-sm-6"},null,8,["modelValue","label","invalid"]),a(D,{modelValue:l.scheduled_pickup_time,"onUpdate:modelValue":o[3]||(o[3]=e=>l.scheduled_pickup_time=e),label:r.$t("order.scheduledPickupTime"),invalid:n(f).scheduled_pickup_time,options:n(ye),"emit-value":"","map-options":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","label","invalid","options"])])):y("",!0),l.team_id&&l.scheduled_pickup_date&&l.scheduled_pickup_time?(i(),m("div",Me,[Te,h("span",Ie,[a(I,{modelValue:u.value,"onUpdate:modelValue":[o[4]||(o[4]=e=>u.value=e),o[5]||(o[5]=e=>U())],label:"Washing & Ironing"},null,8,["modelValue"])]),u.value?y("",!0):(i(),m("span",Re,[(i(!0),m(z,null,ae(l.productcategories,e=>(i(),m("span",{key:e.product_category_id,class:"q-mr-sm"},[a(I,{modelValue:e.active,"onUpdate:modelValue":g=>e.active=g,label:n(we)(e.product_category_id,w.value)},null,8,["modelValue","onUpdate:modelValue","label"])]))),128))]))])):y("",!0),l.team_id&&l.scheduled_pickup_date&&l.scheduled_pickup_time&&l.productcategories&&l.productcategories.filter(e=>e.active).length?(i(),m("div",Ae,[a(Se,{team_id:l.team_id,scheduled_pickup_date:l.scheduled_pickup_date,scheduled_pickup_time:l.scheduled_pickup_time,modelValue:l.contractor_user_id,"onUpdate:modelValue":o[6]||(o[6]=e=>l.contractor_user_id=e),reassign:!0,productcategories:l.productcategories.filter(e=>e.active)},null,8,["team_id","scheduled_pickup_date","scheduled_pickup_time","modelValue","productcategories"]),h("div",xe,[a(te,{modelValue:l.recurring_order,"onUpdate:modelValue":o[7]||(o[7]=e=>l.recurring_order=e),label:r.$t("order.recurring")},null,8,["modelValue","label"]),l.recurring_order?(i(),q(D,{key:0,modelValue:l.recurring,"onUpdate:modelValue":o[8]||(o[8]=e=>l.recurring=e),label:r.$t("order.recurringFrequency"),options:["Week","Fortnite","Month"]},null,8,["modelValue","label"])):y("",!0)])])):y("",!0)]),_:1}),a(le,{align:"right"},{default:t(()=>[O(a(Q,{label:"Cancel",flat:"",color:"secondary"},null,512),[[S]]),a(Q,{disable:_.value||n(f).$invalid||!l.productcategories.filter(e=>e.active).length,label:"Save",color:"primary",onClick:o[9]||(o[9]=e=>s())},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ee={class:"q-pl-md q-pt-sm q-pr-md q-pb-sm flex items-center",style:{"padding-top":"11px"}},Je={key:0},je={class:"q-ml-sm"},Va=E({__name:"OrderManagement",setup(Y){const c=j("bus"),u=X(),w=p(),V=p(!1),l=p(null),_=J({keyword:null}),$=[{name:"display_id",label:u.t("order.id"),align:"left",field:"display_id",sortable:!0,style:"width:100px"},{name:"scheduled_pickup_date",sortable:!0,label:u.t("order.scheduledPickupDate"),field:"scheduled_pickup_date",align:"left",style:"width:100px"},{name:"team_id",label:u.t("team.name"),align:"left",field:"team_id",sortable:!0},{name:"contractor_user_id",label:u.t("contractor.name"),align:"left",field:"contractor_user_id",sortable:!0},{name:"total_price",label:"Total",align:"left",field:"total_price",sortable:!0},{name:"status",label:"Status",align:"left",field:"status",sortable:!0},{label:"Actions",name:"actions",sortable:!1,field:"actions"}],d=p({page:1,rowsNumber:F(),rowsPerPage:F(),sortBy:"display_id",descending:!0}),P=(s=null)=>{let r,o,e,g;s&&s.pagination?(r=s.pagination.page,o=s.pagination.rowsPerPage,e=s.pagination.sortBy,g=s.pagination.descending):(r=d.value.page,o=d.value.rowsPerPage,e=d.value.sortBy,g=d.value.descending),V.value=!0,L.post(`/order/datatable/${r}`,{sortBy:e,sort_order:g?"desc":"asc",skip:r,rowsPerPage:o,keyword:_.keyword}).then(C=>{var T;w.value=C.data.rows,V.value=!1,Ve(o),d.value.rowsNumber=C.data.total,d.value.page=r,d.value.rowsPerPage=o,d.value.sortBy=e,d.value.descending=g,s&&((T=l.value)==null||T.scrollIntoView({behavior:"smooth",block:"center"}))}).catch(C=>{M(C)})},f=s=>{qe("This action is not reversible").onOk(()=>{L.delete(`/order/${s}`).then(()=>{P()}).catch(r=>{M(r)})})},U=()=>{c.emit("newOrder")};return H(()=>{c.on("orderLoadMore",()=>{P()}),P()}),W(()=>{c.off("orderLoadMore")}),(s,r)=>{const o=re("router-link");return i(),m(z,null,[a(Fe),a(_e,{view:"lHh LpR fFf",container:"",class:"layout-height"},{default:t(()=>[a(ne,{class:se({"page-title text-black":!s.$q.dark.isActive,"bg-dark":s.$q.dark.isActive}),bordered:""},{default:t(()=>[h("div",Ee,[a(ie,null,{separator:t(()=>[a(N,{size:"1.5em",name:"chevron_right"})]),default:t(()=>[a(R,{label:"Home",icon:"home",to:{name:"appDashboard"}}),a(R,{label:s.$t("order.namePlural")},null,8,["label"])]),_:1}),a(de,{modelValue:_.keyword,"onUpdate:modelValue":r[0]||(r[0]=e=>_.keyword=e),debounce:500,placeholder:`Search ${s.$t("order.namePlural").toLowerCase()}`,borderless:"",dense:"",class:"q-ml-lg"},{prepend:t(()=>[a(N,{name:"search"})]),_:1},8,["modelValue","placeholder"]),a(K),a(Q,{to:{name:"bookingmanager"},label:"Manager",color:"secondary",class:"q-mr-sm"}),a(Q,{onClick:r[1]||(r[1]=e=>U()),round:"",icon:"add",color:"primary"})])]),_:1},8,["class"]),a(fe,null,{default:t(()=>[a(pe,{padding:""},{default:t(()=>[a(G,null,{default:t(()=>[h("div",{ref_key:"topRef",ref:l},null,512),a(ue,{rows:w.value,columns:$,"row-key":"id",filter:_.keyword,loading:V.value,pagination:d.value,"onUpdate:pagination":r[2]||(r[2]=e=>d.value=e),onRequest:P,class:"no-shadow","rows-per-page-options":n(Qe)},{"body-cell-scheduled_pickup_date":t(e=>[a(b,{props:e},{default:t(()=>[a(o,{to:{name:"order-edit",params:{id:e.row.id}},class:"link"},{default:t(()=>[v(k(e.row.scheduled_pickup_date)+" ("+k(n($e)(e.row.scheduled_pickup_time))+") ",1),e.row.recurring_order?(i(),q(N,{key:0,name:"sync",title:"Recurring"})):y("",!0)]),_:2},1032,["to"])]),_:2},1032,["props"])]),"body-cell-display_id":t(e=>[a(b,{props:e},{default:t(()=>[a(o,{to:{name:"order-edit",params:{id:e.row.id}},class:"link"},{default:t(()=>[v("#"+k(e.row.display_id),1)]),_:2},1032,["to"])]),_:2},1032,["props"])]),"body-cell-team_id":t(e=>[a(b,{props:e},{default:t(()=>[a(o,{to:{name:"team-dashboard",params:{id:e.row.team_id}},class:"link",target:"_blank"},{default:t(()=>[v(k(e.row.team.name),1)]),_:2},1032,["to"])]),_:2},1032,["props"])]),"body-cell-contractor_user_id":t(e=>[a(b,{props:e},{default:t(()=>[e.row.contractor?(i(),m("div",Je,[a(o,{to:{name:"contractor-dashboard",params:{id:e.row.contractor_user_id}},class:"link",target:"_blank"},{default:t(()=>[a(Ne,{user:e.row.contractor},null,8,["user"]),h("span",je,k(e.row.contractor.fullname),1)]),_:2},1032,["to"])])):y("",!0)]),_:2},1032,["props"])]),"body-cell-status":t(e=>[a(b,{props:e},{default:t(()=>[a(Ue,{status:e.row.status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-total_price":t(e=>[a(b,{props:e},{default:t(()=>[v(k(n(Pe)(e.row.grand_total_price)),1)]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[a(b,{props:e},{default:t(()=>[a(Q,{flat:"",icon:"more_vert"},{default:t(()=>[a(me,null,{default:t(()=>[a(ce,null,{default:t(()=>[O((i(),q(x,{clickable:"",to:{name:"contractor-edit",params:{id:e.row.id}}},{default:t(()=>[a(A,null,{default:t(()=>[v("Edit record")]),_:1})]),_:2},1032,["to"])),[[S]]),O((i(),q(x,{clickable:"",onClick:g=>f(e.row.id)},{default:t(()=>[a(A,null,{default:t(()=>[v("Delete")]),_:1})]),_:2},1032,["onClick"])),[[S]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{Va as default};
