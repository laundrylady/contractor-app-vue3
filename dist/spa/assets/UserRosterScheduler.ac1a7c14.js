import{A as J,r as c,m as p,K as de,L as r,l as t,O as N,U as g,q as n,G as W,S as D,N as ie,i as ue,g as ce,B as me,o as fe,E as pe,J as A,n as _,F as R,t as ve,R as T,y as U,bv as _e,Q as ge,M as he,b7 as z,s as ye,b8 as B}from"./index.fbd59a76.js";import{a as be,Q as E}from"./QBreadcrumbs.18e816d5.js";import{Q as H}from"./QSpace.8da48267.js";import{Q as ke}from"./format.c926bd4b.js";import{Q as xe}from"./QHeader.de31cb0a.js";import{Q as Se}from"./QCircularProgress.03fa6c11.js";import{Q as Ve}from"./QBtnGroup.bdc458fc.js";import{Q as De}from"./QBadge.3656646d.js";import{Q as $e}from"./QPage.c929a5d1.js";import{Q as Qe,a as Ye}from"./QLayout.8099c30b.js";import{_ as qe}from"./code_thinking.ed37dda4.js";import{t as we}from"./index.esm.fb7d5adc.js";import{u as Ce,r as G}from"./index.esm.b35330f2.js";import{m as h,a as O}from"./axios.b71dd2ad.js";import{u as K}from"./use-quasar.1140b8ec.js";import{Q as Be,e as Me}from"./DateField.33bf04e7.js";import{C as Pe}from"./ClosePopup.117d0adb.js";import{_ as Ue}from"./PostcodeRegionField.cdc91751.js";import{_ as Le}from"./PostcodeRegionGroupField.308124fb.js";import{_ as Re}from"./UserAvatar.a874c3dc.js";import{_ as Oe,a as Fe}from"./UserRosterScheduleCreate.478871ce.js";import{u as F}from"./debug.805a8aef.js";import{c as Ne,n as I}from"./help.24013814.js";import{a as Ae}from"./geolocation.41e2dfdf.js";import"./QResizeObserver.6ff9e290.js";import"./QSelect.5b5bbc87.js";import"./QItemSection.e2ef8c04.js";import"./rtl.af167dee.js";import"./QToolbarTitle.a19fbe89.js";import"./helpers.3afbd4d2.js";const Te={class:"row items-center justify-end"},j=J({__name:"DateFieldSlim",props:{label:null,placeholder:null,modelValue:null,fdc:{type:Boolean},disabled:{type:Boolean},dark:{type:Boolean},previous:null,after:null,samePrevious:null,borderless:{type:Boolean},outlined:{type:Boolean},hint:null,year:null,filled:{type:Boolean}},emits:["update:modelValue"],setup(k,{emit:i}){const d=k,L=K(),m=c(),x=c(),Y=s=>{x.value&&x.value.hide(),i("update:modelValue",s)},$=s=>{i("update:modelValue",s)},q=()=>{if(m.value=!1,d.modelValue){let s=d.modelValue;if(s=s.replace("/",""),s=s.replace("/",""),s=s.replace(/\D/g,""),s=s.replace(" ",""),s.length<6)i("update:modelValue",null),m.value="Please enter a valid date";else{const y=s,Q=s,w=s;let M=Q.slice(0,2);M+="/";let P=y.slice(2,4);P+="/";let l=w.slice(4,8);l.length!==4&&(l=l.slice(0,2),d.year?l=d.year+l:l=`20${l}`);const C=M+P+l;if(C&&!C.match("undefined")){const f=h(C,"DD/MM/YYYY"),v=new Date;if(v.setHours(0,0,0,0),f.isValid()){let S=!0,V=null;d.fdc&&!f.isAfter(v)&&!f.isSame(v)&&(S=!1,L.dialog({title:"Invalid date",message:`Please enter a date on or after ${d.after}`})),d.after&&(f.isSameOrAfter(h(d.after,"DD/MM/YYYY"))||(S=!1,V=`Please enter a date on or after ${d.after}`)),d.previous&&f.isAfter(v)&&(S=!1,V="Please enter a previous date"),d.samePrevious&&(f.endOf("day").isSameOrBefore(h(v).endOf("day"))||(S=!1,V="Please enter a previous date")),m.value=V,S?i("update:modelValue",C):i("update:modelValue",null)}else i("update:modelValue",null),m.value="Please enter a valid date"}}}};return(s,y)=>(p(),de(ie,{filled:k.filled,outlined:k.outlined,"model-value":k.modelValue,mask:"##/##/####",label:k.label,style:{width:"130px"},"onUpdate:modelValue":$,onBlur:y[1]||(y[1]=Q=>q())},{append:r(()=>[t(N,{name:"event",class:"cursor-pointer",onBlur:y[0]||(y[0]=Q=>q())},{default:r(()=>[t(g(Be),{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"qDateProxy",ref:x},{default:r(()=>[t(Me,{"model-value":k.modelValue,"onUpdate:modelValue":Y,mask:"DD/MM/YYYY",color:"secondary"},{default:r(()=>[n("div",Te,[W(t(D,{label:"Close",color:"primary",flat:""},null,512),[[Pe]])])]),_:1},8,["model-value"])]),_:1},512)]),_:1})]),_:1},8,["filled","outlined","model-value","label"]))}}),ze={class:"q-pl-md q-pt-sm q-pr-md q-pb-sm flex items-center",style:{"padding-top":"11px"}},Ee={class:"q-pa-lg",style:{width:"500px"}},He=n("div",{class:"text-h6"},"Suburb Group",-1),Ge=n("div",{class:"text-h6"},"Individual Suburb",-1),Ie={key:0,class:"text-center text-grey",style:{"margin-top":"200px"}},je=n("div",{class:"q-mb-lg"},[n("img",{src:qe,style:{"max-height":"150px"}})],-1),Je={class:"flex"},We={key:0,class:"flex"},Ke={class:"flex items-center"},Xe={class:"q-ml-sm"},Ze={class:"text-bold",style:{"line-height":"0.9rem"}},et={class:"q-mt-sm"},tt={class:"text-center q-pa-xs"},at={class:"q-mt-xs"},ot=["onMouseenter"],lt={key:0,style:{display:"flex","justify-content":"space-evenly","flex-wrap":"wrap","align-items":"center","font-weight":"400","font-size":"12px",height:"auto"}},st={key:1,class:"text-center q-mt-sm"},Rt=J({__name:"UserRosterScheduler",setup(k){const i=K(),d=ue("bus"),L=c(),m=c(),x=c(!1),Y=c([]),$=c(),q=c(we()),s=c(),y=c(),Q=c(),w=c(),M=ce(()=>({"--calendar-resources-width":150+"px"})),P={keyword:null,start:h().startOf("isoWeek").format("DD/MM/YYYY"),end:h().endOf("isoWeek").format("DD/MM/YYYY"),postcode_region_group_id:null,postcode_region_id:null},l=me(JSON.parse(JSON.stringify(P))),f=Ce({start:{required:G},end:{required:G}},l,{$scope:!1}),v=()=>{i.loading.show({message:"Fetching schedule..."}),O.post("/userrosterschedule/scheduler",l).then(o=>{m.value=o.data,Y.value=o.data.map(e=>e.user),x.value=!0,S()}).catch(o=>{i.loading.hide(),F(o)})},S=()=>{O.post("/user/contractor/landing",{start:l.start,end:l.end,postcode_region_group_id:l.postcode_region_group_id,postcode_region_id:l.postcode_region_id}).then(o=>{w.value=o.data,i.loading.hide()}).catch(o=>{F(o),i.loading.hide()})},V=o=>{Q.value=o},X=()=>{s.value&&s.value.moveToToday()},Z=()=>{s.value&&s.value.prev()},ee=()=>{s.value&&s.value.next()},te=o=>{const e=h(o.start).format("DD/MM/YYYY"),u=h(o.end).format("DD/MM/YYYY");l.start!==e&&l.end!==u&&(l.start=e,l.end=u,v())},ae=o=>{const e=h();return!!h(o.timestamp.date).isSameOrAfter(e)},oe=o=>{if(!m.value)return[];const e=m.value.find(u=>u.user.id===o.resource.id);return e?e.schedule.filter(u=>u.day===o.timestamp.date):[]},le=o=>{if(!m.value)return!1;const e=m.value.find(u=>u.user.id===o.resource.id);return e?e.schedule.filter(u=>u.day===o.timestamp.date).length>0:[]},se=o=>{d.emit("editUserRosterSchedule",o)},re=o=>{Ne("This will create a new entry for this day").onOk(()=>{d.emit("newUserRosterSchedule",{day:o.timestamp.date,user:o.resource})})};return fe(async()=>{L.value=await Ae(),O.get("/postcoderegiongroup/index").then(o=>{y.value=o.data.map(e=>({value:e.id,label:e.name}))}).catch(o=>{F(o)}),d.on("getSchedule",()=>{v()})}),pe(()=>{d.off("getSchedule")}),(o,e)=>{const u=A("router-link"),ne=A("q-calendar-scheduler");return p(),_(R,null,[t(Oe),t(Fe),t(Qe,{view:"lHh LpR fFf",container:"",class:"layout-height"},{default:r(()=>[t(xe,{class:ve({"page-title text-black":!g(i).dark.isActive,"bg-dark":g(i).dark.isActive}),bordered:""},{default:r(()=>[n("div",ze,[t(be,null,{separator:r(()=>[t(N,{size:"1.5em",name:"chevron_right"})]),default:r(()=>[t(E,{label:"Home",icon:"home",to:{name:"appDashboard"}}),t(E,{label:"Scheduler"})]),_:1}),t(H),t(D,{icon:"place",label:`${Q.value||"Location"}`,flat:"",color:"grey","no-caps":"",class:"form-field-padding-dense"},{default:r(()=>[t(ke,null,{default:r(()=>[n("div",Ee,[He,t(Le,{modelValue:l.postcode_region_group_id,"onUpdate:modelValue":e[0]||(e[0]=a=>l.postcode_region_group_id=a),label:"Choose an area",outlined:!0,dense:!0,class:"q-mb-md",onSelectedLocation:V},null,8,["modelValue"]),Ge,t(Ue,{modelValue:l.postcode_region_id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.postcode_region_id=a),label:"Specific Suburb",dense:!0,outlined:!0,onSelectedLocation:V},null,8,["modelValue"])])]),_:1})]),_:1},8,["label"]),t(j,{modelValue:l.start,"onUpdate:modelValue":e[2]||(e[2]=a=>l.start=a),invalid:g(f).start.$invalid,label:"Start date",dense:!0,outlined:!0,"no-hint":!0,class:"q-mr-sm q-ml-sm"},null,8,["modelValue","invalid"]),t(j,{modelValue:l.end,"onUpdate:modelValue":e[3]||(e[3]=a=>l.end=a),invalid:g(f).end.$invalid,label:"End date",dense:!0,outlined:!0,"no-hint":!0,class:"q-mr-sm"},null,8,["modelValue","invalid"]),t(D,{onClick:e[4]||(e[4]=a=>v()),disable:g(f).$invalid||!l.postcode_region_group_id&&!l.postcode_region_id,icon:"search",label:"Search",color:"primary"},null,8,["disable"])])]),_:1},8,["class"]),t(Ye,null,{default:r(()=>[t($e,{padding:""},{default:r(()=>[x.value?U("",!0):(p(),_("div",Ie,[je,t(N,{name:"place"}),T(" Select a location above to get started ")])),W(n("div",null,[t(ge,{class:"bg-seamless q-mt-md"},{default:r(()=>[t(he,null,{default:r(()=>[n("div",Je,[t(H),w.value?(p(),_("div",We,[(p(!0),_(R,null,z(w.value,a=>(p(),_("div",{key:a.name,class:"q-mr-lg"},[n("div",Ke,[t(Se,{value:a.per,size:"32px",color:"primary","track-color":"grey-5"},null,8,["value"]),n("div",Xe,[n("div",Ze,B(a.name)+" Bookings",1),n("div",null,B(a.oc)+"/"+B(a.cc)+" - "+B(a.per)+"% ",1)])])]))),128))])):U("",!0),n("div",null,[t(Ve,null,{default:r(()=>[t(D,{onClick:e[5]||(e[5]=a=>Z()),icon:"chevron_left",color:"secondary"}),t(D,{onClick:e[6]||(e[6]=a=>X()),label:"Today",color:"secondary"}),t(D,{onClick:e[7]||(e[7]=a=>ee()),icon:"chevron_right",color:"secondary"})]),_:1})])]),n("div",et,[t(ne,{ref_key:"calendarRef",ref:s,modelValue:q.value,"onUpdate:modelValue":e[8]||(e[8]=a=>q.value=a),"model-resources":Y.value,"onUpdate:modelResources":e[9]||(e[9]=a=>Y.value=a),view:"week","short-weekday-label":"",animated:"",bordered:"",weekdays:[1,2,3,4,5,6,0],style:ye(g(M)),onChange:te},{"resource-label":r(({scope:a})=>[n("div",tt,[t(Re,{user:a.resource},null,8,["user"]),n("div",at,[t(u,{to:{name:"contractor-dashboard",params:{id:a.resource.id}},target:"_blank",class:"link"},{default:r(()=>[T(B(a.resource.fullname),1)]),_:2},1032,["to"])])])]),day:r(({scope:a})=>[n("div",{onMouseenter:b=>$.value={resource:a.resource.id,date:a.timestamp.date},style:{height:"100%"}},[le(a)?(p(),_("div",lt,[(p(!0),_(R,null,z(oe(a),b=>(p(),_("div",{key:b.time,class:"q-mt-xs"},[t(De,{label:`${g(I)(b.start_time)} - ${g(I)(b.end_time)} (${b.orders})`,class:"q-mb-xs cursor-pointer",onClick:rt=>se(b.id),color:b.active?"positive":"negative"},null,8,["label","onClick","color"])]))),128))])):U("",!0),ae(a)&&$.value&&$.value.resource===a.resource.id&&$.value.date===a.timestamp.date?(p(),_("div",st,[t(D,{onClick:b=>re(a),icon:"add_circle",flat:"",size:"sm",dense:"",label:o.$t("schedule.create"),color:"grey-6"},null,8,["onClick","label"])])):U("",!0)],40,ot)]),_:1},8,["modelValue","model-resources","style"])])]),_:1})]),_:1})],512),[[_e,x.value]])]),_:1})]),_:1})]),_:1})],64)}}});export{Rt as default};
