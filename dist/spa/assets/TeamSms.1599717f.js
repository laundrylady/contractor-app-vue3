import{Q as q}from"./QSelect.5b5bbc87.js";import{A as C,i as B,r as p,B as O,o as A,m as l,K as T,L as f,l as m,N as J,U as y,n as o,R as x,q as d,F as V,b7 as $,y as v,M as L,S as U,ae as D,Q as E,b8 as u}from"./index.fbd59a76.js";import{u as F,r as N}from"./index.esm.b35330f2.js";import{a as k}from"./axios.b71dd2ad.js";import{u as w}from"./debug.805a8aef.js";import{b as j}from"./help.24013814.js";import{_ as I}from"./SmsLogComponent.fded254f.js";import"./QItemSection.e2ef8c04.js";import"./rtl.af167dee.js";import"./format.c926bd4b.js";import"./QTable.1191bda5.js";import"./QList.eaa15994.js";import"./QMarkupTable.e4b2956c.js";import"./QLinearProgress.457e2dab.js";const K=d("div",{class:"text-h6 q-mb-md"},"Send SMS",-1),R={key:0,class:"q-pa-md"},z={key:1,class:"q-pa-md bg-positive text-white"},G=C({__name:"SendSmsTeam",props:{team:null},setup(r){const s=r,g=B("bus"),i=p([]),c=p(!1),b=p(),S={content:null,template:null,number:null,team_id:s.team.id},a=O(JSON.parse(JSON.stringify(S))),_=F({content:{required:N},team_id:{required:N}},a),h=p(),M=()=>{a.content=a.template},Q=()=>{c.value=!0,k.post("/sms/sendteam",a).then(n=>{j("positive",`SMS sent to ${s.team.name}`),c.value=!1,i.value=n.data,g.emit("getSmsLog",{}),Object.assign(a,JSON.parse(JSON.stringify(S)))}).catch(n=>{w(n),c.value=!1})};return A(()=>{Object.assign(a,{content:null,template:null,number:null,team_id:s.team.id});const n=[];s.team&&s.team.users&&(s.team.users.forEach(e=>{e.user.mobile&&e.user.sms_notifications&&n.push(e.user)}),h.value=n),k.get("/smstemplate/index").then(e=>{b.value=e.data.map(t=>({value:t.content,label:t.name}))}).catch(e=>{w(e)})}),(n,e)=>(l(),T(E,null,{default:f(()=>[m(L,null,{default:f(()=>[K,m(q,{modelValue:a.template,"onUpdate:modelValue":[e[0]||(e[0]=t=>a.template=t),e[1]||(e[1]=t=>M())],options:b.value,label:"Choose a Template","map-options":"","emit-value":"",class:"q-mb-md"},null,8,["modelValue","options"]),m(J,{modelValue:a.content,"onUpdate:modelValue":e[2]||(e[2]=t=>a.content=t),type:"textarea",maxlength:"160",label:"Message to send",error:y(_).content.$error,autogrow:""},null,8,["modelValue","error"]),!i.value||!i.value.length?(l(),o("div",R,[x(" A message will be sent to the following members: "),d("ul",null,[(l(!0),o(V,null,$(h.value,t=>(l(),o("li",{key:t.id},u(t.fullname)+" ("+u(t.mobile)+") ",1))),128))])])):v("",!0),i.value&&i.value.length?(l(),o("div",z,[x(" A message was sent to the following members: "),d("ul",null,[(l(!0),o(V,null,$(i.value,t=>(l(),o("li",{key:t.id},u(t.user.fullname)+" ("+u(t.user.mobile)+") ",1))),128))])])):v("",!0)]),_:1}),m(D,{align:"right"},{default:f(()=>[m(U,{color:"primary",disabled:y(_).$invalid,loading:c.value,onClick:e[3]||(e[3]=t=>Q()),label:"Send"},null,8,["disabled","loading"])]),_:1})]),_:1}))}}),H={key:0},P=d("div",{class:"text-h5"},"SMS Activities",-1),de=C({__name:"TeamSms",props:{model:null},setup(r){return(s,g)=>r.model.id?(l(),o("div",H,[P,d("p",null,"Send an SMS or view the history for this "+u(s.$t("team.name"))+".",1),m(G,{team:r.model,class:"q-mb-lg"},null,8,["team"]),m(I,{team_id:r.model.id},null,8,["team_id"])])):v("",!0)}});export{de as default};
