import{Q as pe}from"./QLinearProgress.6e390987.js";import{Q as G}from"./rtl.ba9e3bff.js";import{A as F,r as b,B as Z,i as ee,o as te,E as oe,m as t,K as C,L as d,Q as M,l as e,R as I,ai as y,U as v,G as K,S as B,ag as se,M as le,q as r,n as a,F as w,b1 as S,N as ae,y as p,ae as ve,aj as _e,J as ge,O as P,u as ye,ah as fe,b2 as he}from"./index.7da93179.js";import{Q as W,a as j}from"./QItem.642560fa.js";import{Q as be}from"./QList.709f4980.js";import{Q as U}from"./QSelect.0342b451.js";import{u as re,r as V}from"./index.esm.0811bb15.js";import{a as N}from"./axios.07c7c7d9.js";import{u as O}from"./debug.9f3fb657.js";import{m as ne,v as ie,t as L,u as ue,d as ke,g as Ve,n as X,w as qe,x as $e,a as xe}from"./help.4068c5a1.js";import{a as de}from"./helpers.84dd3d7a.js";import{Q as Qe,a as Ce}from"./QToolbarTitle.8a26e038.js";import{Q as we}from"./QSpace.2d911a61.js";import{C as Y}from"./ClosePopup.42f5b568.js";import"./QMenu.00781621.js";import"./format.3e32b8d9.js";const Ue={class:"row q-col-gutter-md"},Re={class:"row q-col-gutter-md"},Se={class:"col-xs-12 col-sm-6"},Be=r("div",{class:"q-mb-sm"},"Choose the day, start and end times",-1),Ne={class:"row q-col-gutter-md"},Oe={class:"col-xs-12 col-sm-6"},De=r("div",{class:"q-mb-sm"},"Capacity for this timeslot:",-1),Te={key:0,class:"row q-col-gutter-md"},Ie={key:0},Le=F({__name:"UserRosterEdit",setup(D){const f=b(!1),R=b(),n=Z({id:null,day:null,start_time:null,end_time:null,active:!0,user_id:null,user:null,user_postcoderegion_group_id:null,capacity:{products:[]}}),k=b(!1),h=ee("bus"),q=b(),$=b(),A=re({user_postcoderegion_group_id:{required:V},day:{required:V},start_time:{required:V},end_time:{required:V}},n),c=_=>{q.value=!1,k.value=!0,N.put(`/userroster/${n.id}`,n).then(()=>{ke("positive","Roster updated"),h.emit("getRoster"),_&&(f.value=!1),k.value=!1}).catch(s=>{k.value=!1,q.value=s.response.data,O(s)})},H=_=>_?L.filter(s=>s.value>_&&s.value<=_+3):L,E=_=>{_.qty||(_.qty=0)};return te(()=>{h.on("editRoster",async _=>{$.value=await de(),N.get(`/userroster/${_}`).then(s=>{Object.assign(n,s.data),N.get(`/userpostcoderegiongroup/index/${n.user_id}`).then(o=>{R.value=o.data.map(x=>({value:x.id,label:x.name}))}).catch(o=>{O(o)}),f.value=!0}).catch(s=>{O(s)})})}),oe(()=>{h.off("editRoster")}),(_,s)=>(t(),C(_e,{modelValue:f.value,"onUpdate:modelValue":s[5]||(s[5]=o=>f.value=o)},{default:d(()=>[n.day?(t(),C(M,{key:0,class:"modal"},{default:d(()=>[e(Qe,null,{default:d(()=>[e(Ce,null,{default:d(()=>[I(y(v(ne)(n.day)),1)]),_:1}),e(we),K(e(B,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),e(se),e(le,null,{default:d(()=>[r("div",Ue,[e(U,{modelValue:n.user_postcoderegion_group_id,"onUpdate:modelValue":s[0]||(s[0]=o=>n.user_postcoderegion_group_id=o),label:"Select the pickup area",options:R.value,"map-options":"","emit-value":"",error:v(A).user_postcoderegion_group_id.$invalid,filled:"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options","error"]),e(U,{modelValue:n.day,"onUpdate:modelValue":s[1]||(s[1]=o=>n.day=o),outlined:"",options:v(ie),"map-options":"","emit-value":"",label:"Day",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"])]),r("div",Re,[r("div",Se,[Be,r("div",Ne,[e(U,{modelValue:n.start_time,"onUpdate:modelValue":s[2]||(s[2]=o=>n.start_time=o),outlined:"",dense:"",options:v(L),"map-options":"","emit-value":"",label:"Start Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"]),e(U,{modelValue:n.end_time,"onUpdate:modelValue":s[3]||(s[3]=o=>n.end_time=o),outlined:"",dense:"",options:H(n.start_time),"map-options":"","emit-value":"",label:"End Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"])])]),r("div",Oe,[De,n.capacity.products?(t(),a("div",Te,[(t(!0),a(w,null,S(n.capacity.products,(o,x)=>(t(),a("div",{key:x,class:"col-xs-12 col-sm-6"},[e(ae,{modelValue:o.qty,"onUpdate:modelValue":J=>o.qty=J,outlined:"",dense:"",label:v(ue)(o.product_category_id,$.value),"options-cover":"",onBlur:J=>E(o),class:"q-mb-md"},null,8,["modelValue","onUpdate:modelValue","label","onBlur"])]))),128))])):p("",!0)])]),q.value?(t(),a("div",Ie,[r("ul",null,[(t(!0),a(w,null,S(q.value.errors,(o,x)=>(t(),a("li",{key:x,class:"text-negative"},y(o.message),1))),128))])])):p("",!0)]),_:1}),e(ve,{align:"right"},{default:d(()=>[K(e(B,{label:"Cancel",flat:"",color:"secondary"},null,512),[[Y]]),e(B,{disable:k.value||v(A).$invalid,label:"Update",color:"primary",onClick:s[4]||(s[4]=o=>c(!0)),loading:k.value},null,8,["disable","loading"])]),_:1})]),_:1})):p("",!0)]),_:1},8,["modelValue"]))}}),Ae={key:0,class:"q-mb-md"},Ee={key:1},Je={class:"flex items-center"},Pe={class:"q-mr-lg"},je={key:1,class:"text-grey q-mr-md"},Me={key:2,class:"q-mt-md"},Fe={key:3,class:"q-mt-md"},He=r("div",{class:"text-h6 q-mb-sm"},"Add a new roster entry",-1),ze={class:"row q-col-gutter-md"},Ge={class:"row q-col-gutter-md"},Ke={class:"col-xs-12 col-sm-6"},We=r("div",{class:"q-mb-sm"},"Start and end times",-1),Xe={class:"row q-col-gutter-md"},Ye={class:"col-xs-12 col-sm-6"},Ze=r("div",{class:"q-mb-sm"},"Capacity for this timeslot:",-1),et={key:0,class:"row q-col-gutter-md"},tt={key:0},ot={class:"q-mt-lg"},st=F({__name:"UserRosterManagement",props:{user:null},setup(D){const f=D,R=ee("bus"),n=b(!1),k=b(),h=b(),q=b(),$=b(),g=b(!1),A={user_id:f.user.id,day:[],start_time:null,end_time:null,active:!0,user_postcoderegion_group_id:null,capacity:{products:[]}},c=Z(JSON.parse(JSON.stringify(A))),E=re({user_id:{required:V},day:{required:V},start_time:{required:V},end_time:{required:V},user_postcoderegion_group_id:{required:V},capacity:{products:{required:V}}},c,{$scope:!1}),_=()=>{k.value=!1,g.value=!0,N.post("/userroster",c).then(()=>{o(),Object.assign(c,JSON.parse(JSON.stringify(A))),g.value=!1,n.value=!1}).catch(l=>{g.value=!1,k.value=l.response.data,O(l)})},s=l=>{xe("Remove this roster entry?").onOk(()=>{N.delete(`/userroster/${l}`).then(()=>{o()}).catch(u=>{O(u)})})},o=()=>{g.value=!0,N.get(`/userroster/index?user_id=${f.user.id}`).then(l=>{h.value=Ve(l.data,"day"),g.value=!1}).catch(l=>{O(l),g.value=!1})},x=l=>{R.emit("editRoster",l)},J=l=>l?L.filter(u=>u.value>l&&u.value<=l+3):L,ce=l=>{l.qty||(l.qty=0)};return te(async()=>{q.value=await de();for(const l of q.value)c.capacity.products.push({product_category_id:l.value,qty:0});N.get(`/userpostcoderegiongroup/index/${f.user.id}`).then(l=>{$.value=l.data.map(u=>({value:u.id,label:`${u.name} (${u.postcoderegions.length} suburbs)`}))}).catch(l=>{O(l)}),o(),R.on("getRoster",()=>{o()})}),oe(()=>{R.off("getRoster")}),(l,u)=>{const me=ge("router-link");return t(),a(w,null,[e(Le),g.value?(t(),C(pe,{key:0,indeterminate:""})):p("",!0),r("div",null,[!g.value&&(!h.value||!h.value.length)?(t(),a("div",Ae," No roster found. ")):p("",!0)]),h.value&&h.value.length?(t(),a("div",Ee,[e(M,{style:{"min-height":"200px"}},{default:d(()=>[(t(!0),a(w,null,S(h.value,(i,Q)=>(t(),a("div",{key:i.key},[e(be,{separator:""},{default:d(()=>[e(G,{header:"",class:"text-h6 q-pb-none text-black"},{default:d(()=>[I(y(v(ne)(parseFloat(i.key))),1)]),_:2},1024),(t(!0),a(w,null,S(i.data,m=>(t(),C(W,{key:m.id},{default:d(()=>[e(j,null,{default:d(()=>[r("div",Je,[m.active?(t(),C(P,{key:0,name:"check_circle",color:"positive",class:"q-mr-sm"})):p("",!0),r("div",Pe,y(v(X)(m.start_time))+" to "+y(v(X)(m.end_time))+" ("+y(v(qe)(m.duration))+") ",1),m.postcoderegiongroup&&m.postcoderegiongroup.postcoderegions?(t(),a("div",je,[e(P,{name:"place"}),I(" "+y(m.postcoderegiongroup.postcoderegions.length),1)])):p("",!0),(t(!0),a(w,null,S(m.capacity.products,(T,z)=>(t(),a("div",{key:z,class:"q-mr-md text-grey"},[e(P,{name:v($e)(T.product_category_id,q.value)},null,8,["name"]),I(" "+y(T.qty),1)]))),128))])]),_:2},1024),e(j,{side:""},{default:d(()=>[r("div",null,[e(B,{onClick:T=>x(m.id),icon:"edit",flat:"",class:"q-mr-xs"},null,8,["onClick"]),e(B,{onClick:T=>s(m.id),icon:"delete",flat:""},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),Q+1!==h.value.length?(t(),C(se,{key:0,class:"q-mb-sm"})):p("",!0)]))),128))]),_:1})])):p("",!0),!g.value&&(!$.value||$.value.length===0)?(t(),a("div",Me,[e(me,{to:{name:"contractor-postcoderegion-groups",params:{id:D.user.id}},class:"link"},{default:d(()=>[e(P,{name:"warning"}),I(" Please configure the pickup locations before creating the roster.")]),_:1},8,["to"])])):p("",!0),n.value?p("",!0):(t(),a("div",Fe,[$.value&&$.value.length?(t(),C(B,{key:0,onClick:u[0]||(u[0]=i=>n.value=!0),label:"Add roster entry",color:"primary"})):p("",!0)])),n.value?(t(),C(M,{key:4,class:"q-mt-lg"},{default:d(()=>[e(le,null,{default:d(()=>[He,r("div",ze,[e(U,{modelValue:c.user_postcoderegion_group_id,"onUpdate:modelValue":u[1]||(u[1]=i=>c.user_postcoderegion_group_id=i),label:"Select the pickup area",options:$.value,"map-options":"","emit-value":"",error:v(E).user_postcoderegion_group_id.$invalid,filled:"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options","error"]),e(U,{modelValue:c.day,"onUpdate:modelValue":u[2]||(u[2]=i=>c.day=i),outlined:"",options:v(ie),"map-options":"","emit-value":"",label:"Days",multiple:"",class:"col-xs-12 col-md-6"},{option:d(({itemProps:i,opt:Q,selected:m,toggleOption:T})=>[e(W,ye(fe(i)),{default:d(()=>[e(j,null,{default:d(()=>[e(G,null,{default:d(()=>[I(y(Q.label),1)]),_:2},1024)]),_:2},1024),e(j,{side:""},{default:d(()=>[e(he,{"model-value":m,"onUpdate:modelValue":z=>T(Q)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),r("div",Ge,[r("div",Ke,[We,r("div",Xe,[e(U,{modelValue:c.start_time,"onUpdate:modelValue":u[3]||(u[3]=i=>c.start_time=i),outlined:"",dense:"",options:v(L),"map-options":"","emit-value":"",label:"Start Time","options-cover":"",class:"col-xs-12 col-sm-12 col-md-6"},null,8,["modelValue","options"]),e(U,{modelValue:c.end_time,"onUpdate:modelValue":u[4]||(u[4]=i=>c.end_time=i),outlined:"",dense:"",options:J(c.start_time),"map-options":"","emit-value":"",label:"End Time","options-cover":"",class:"col-xs-12 col-sm-12 col-md-6"},null,8,["modelValue","options"])])]),r("div",Ye,[Ze,c.capacity.products?(t(),a("div",et,[(t(!0),a(w,null,S(c.capacity.products,(i,Q)=>(t(),a("div",{key:Q,class:"col-xs-12 col-sm-6"},[e(ae,{modelValue:i.qty,"onUpdate:modelValue":m=>i.qty=m,outlined:"",dense:"",label:v(ue)(i.product_category_id,q.value),"options-cover":"",onBlur:m=>ce(i),class:"q-mb-md"},null,8,["modelValue","onUpdate:modelValue","label","onBlur"])]))),128))])):p("",!0)])]),k.value?(t(),a("div",tt,[r("ul",null,[(t(!0),a(w,null,S(k.value.errors,(i,Q)=>(t(),a("li",{key:Q,class:"text-negative"},y(i.message),1))),128))])])):p("",!0),r("div",ot,[e(B,{onClick:u[5]||(u[5]=i=>_()),disable:v(E).$invalid||g.value,icon:"add_circle",label:"Add Roster",color:"primary",class:"full-width",loading:g.value},null,8,["disable","loading"])])]),_:1})]),_:1})):p("",!0)],64)}}}),lt={key:0},at={class:"text-h5"},Vt=F({__name:"ContractorRoster",props:{model:null},setup(D){return(f,R)=>D.model.id?(t(),a("div",lt,[r("div",at,y(f.$t("roster.name")),1),r("p",null,"Below are the pickup timeslots for this "+y(f.$t("contractor.name").toLowerCase())+".",1),e(st,{user:D.model},null,8,["user"])])):p("",!0)}});export{Vt as default};
