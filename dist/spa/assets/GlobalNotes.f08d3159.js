import{Q as I,a as z}from"./QToolbarTitle.8a26e038.js";import{V as D,ab as $,b6 as L,ac as j,b8 as A,g as k,h as b,H as M,j as O,af as B,A as P,r as _,B as F,o as U,m as d,K as f,L as t,l as a,R as y,y as p,M as E,t as h,n as x,q as S,S as w,N as G,b1 as H,F as K,Q as R,ai as q,U as J}from"./index.7da93179.js";import{Q as W,a as N}from"./QItem.642560fa.js";import{Q as X}from"./QList.709f4980.js";import{a as C}from"./axios.07c7c7d9.js";import{u as Q}from"./debug.9f3fb657.js";import{d as T,l as Y,a as Z}from"./help.4068c5a1.js";import{_ as ee}from"./UserAvatar.41db8b9e.js";var te=D({name:"QInnerLoading",props:{...$,...L,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const c=O(),s=j(e,c.proxy.$q),{transitionProps:u,transitionStyle:r}=A(e),m=k(()=>"q-inner-loading absolute-full column flex-center"+(s.value===!0?" q-inner-loading--dark":"")),g=k(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function v(){const n=[b(B,{size:e.size,color:e.color})];return e.label!==void 0&&n.push(b("div",{class:g.value,style:e.labelStyle},[e.label])),n}function l(){return e.showing===!0?b("div",{class:m.value,style:r.value},o.default!==void 0?o.default():v()):null}return()=>b(M,u.value,l)}});const ae={key:0,class:"q-mb-md"},le={class:"q-mb-lg"},oe={class:"text-grey"},fe=P({__name:"GlobalNotes",props:{notable_type:null,notable_id:null,nobox:{type:Boolean}},setup(e){const o=e,c=_(!1),s=_(!1),u=_(),r=F({notable_type:o.notable_type,notable_id:o.notable_id.toString(),note:null}),m=()=>{C.get("/note/fetch/"+o.notable_type+"/"+o.notable_id).then(l=>{u.value=l.data,s.value=!1,c.value=!0}).catch(l=>{Q(l)})},g=l=>{Z("This will remove the note").onOk(()=>{s.value=!0,C.delete(`/note/${l}`).then(()=>{m(),T("negative","Note removed")}).catch(n=>{Q(n)})})},v=()=>{r.note&&(s.value=!0,C.post("/note",r).then(()=>{m(),T("positive","Note saved"),Object.assign(r,{notable_type:o.notable_type,notable_id:o.notable_id,note:null})}).catch(l=>{Q(l),s.value=!1}))};return U(()=>{m()}),(l,n)=>(d(),f(R,{class:h({"no-shadow bg-transparent":e.nobox})},{default:t(()=>[e.nobox?p("",!0):(d(),f(I,{key:0,class:"bg-primary text-white"},{default:t(()=>[a(z,null,{default:t(()=>[y("Notes")]),_:1})]),_:1})),a(te,{showing:!c.value,class:"inner-loading-mh"},{default:t(()=>[a(B,{size:"50px",color:"primary"})]),_:1},8,["showing"]),c.value?(d(),f(E,{key:1,class:h({"q-pa-none":e.nobox})},{default:t(()=>[u.value.length?p("",!0):(d(),x("div",ae," No notes found. ")),S("div",le,[a(G,{modelValue:r.note,"onUpdate:modelValue":n[1]||(n[1]=i=>r.note=i),type:"textarea",placeholder:"Type a new note",class:h([{"m-t-lg":u.value.length},"q-mb-sm"]),autogrow:"",outlined:""},{append:t(()=>[a(w,{color:"primary",onClick:n[0]||(n[0]=i=>v()),disabled:s.value},{default:t(()=>[y("Add note")]),_:1},8,["disabled"])]),_:1},8,["modelValue","class"])]),a(X,{class:"q-mt-sm"},{default:t(()=>[(d(!0),x(K,null,H(u.value,(i,V)=>(d(),f(W,{key:V},{default:t(()=>[a(N,{avatar:""},{default:t(()=>[a(ee,{user:i.user},null,8,["user"])]),_:2},1024),a(N,null,{default:t(()=>[S("div",oe,q(J(Y)(i.created_at)),1),y(" "+q(i.note),1)]),_:2},1024),a(N,{side:""},{default:t(()=>[a(w,{onClick:ne=>g(i.id),flat:"",color:"grey",icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["class"])):p("",!0)]),_:1},8,["class"]))}});export{fe as _};
