import{Q as M,a as D}from"./QToolbarTitle.8a26e038.js";import{A as x,g as U,m as d,K as L,L as t,R as v,ai as i,U as c,i as R,r as u,B as q,o as O,E as $,n as w,l as a,Q as N,G as A,S as T,M as E,q as P,aj as F,N as G,O as H,y as C,F as S,b1 as I}from"./index.7da93179.js";import{Q as K,a as h}from"./QTable.01150601.js";import{C as J}from"./ClosePopup.42f5b568.js";import{a as W}from"./axios.07c7c7d9.js";import{u as X}from"./debug.9f3fb657.js";import{B as Y,o as V,r as Z,l as ee,f as ae,s as te}from"./help.4068c5a1.js";import{Q as oe}from"./QBadge.d2d220ed.js";const le=x({__name:"AmazonSesStatus",props:{status:null},setup(f){const s=f,m=U(()=>s.status==="Send"?"primary":s.status==="Delivery"||s.status==="Open"?"positive":s.status==="Bounce"?"negative":s.status==="Click"?"positive":"grey");return(y,p)=>(d(),L(oe,{color:c(m)},{default:t(()=>[v(i(c(Y)(f.status)),1)]),_:1},8,["color"]))}}),se=["innerHTML"],ne=P("br",null,null,-1),re={class:"text-grey"},ie={key:0},be=x({__name:"GlobalNotifications",props:{notifiable_id:null,notifiable_type:null,bulk:{type:Boolean}},setup(f){const s=f,m=R("bus"),y=u(),p=u(!1),k=u(),B=u(!1),g=q({keyword:null}),z=[{name:"created_at",label:"Sent",align:"left",field:"created_at",sortable:!0},{name:"to",sortable:!0,label:"To",field:"to",align:"left"},{name:"subject",sortable:!0,label:"Subject",field:"subject",align:"left"},{name:"actions",sortable:!1,label:"",field:"actions",align:"right"}],l=u({page:1,rowsNumber:V(),rowsPerPage:V(),sortBy:"created_at",descending:!0}),Q=(n=null)=>{let o,e,r,_;n&&n.pagination?(o=n.pagination.page,e=n.pagination.rowsPerPage,r=n.pagination.sortBy,_=n.pagination.descending):(o=l.value.page,e=l.value.rowsPerPage,r=l.value.sortBy,_=l.value.descending),p.value=!0,W.post(`/notification/datatable/${o}`,{sortBy:r,sort_order:_?"desc":"asc",skip:o,rowsPerPage:e,keyword:g.keyword,notifiable_id:s.notifiable_id,notifiable_type:s.notifiable_type,bulk:s.bulk}).then(b=>{y.value=b.data.rows,p.value=!1,te(e),l.value.rowsNumber=b.data.total,l.value.page=o,l.value.rowsPerPage=e,l.value.sortBy=r,l.value.descending=_}).catch(b=>{X(b)})},j=n=>{k.value=n,B.value=!0};return O(()=>{Q(),m.on("getNotifications",()=>{Q()})}),$(()=>{m.off("getNotifications")}),(n,o)=>(d(),w(S,null,[a(F,{modelValue:B.value,"onUpdate:modelValue":o[0]||(o[0]=e=>B.value=e)},{default:t(()=>[a(N,{class:"modal"},{default:t(()=>[a(M,null,{default:t(()=>[a(D,null,{default:t(()=>[v(i(k.value.subject),1)]),_:1}),A(a(T,{icon:"close",flat:"",round:"",dense:""},null,512),[[J]])]),_:1}),a(E,null,{default:t(()=>[P("div",{innerHTML:k.value.html_content},null,8,se)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,null,{default:t(()=>[a(K,{rows:y.value,columns:z,"row-key":"id",filter:g.keyword,loading:p.value,pagination:l.value,"onUpdate:pagination":o[2]||(o[2]=e=>l.value=e),onRequest:Q,flat:"","rows-per-page-options":c(Z)},{"top-left":t(()=>[a(G,{modelValue:g.keyword,"onUpdate:modelValue":o[1]||(o[1]=e=>g.keyword=e),debounce:500,placeholder:"Keyword"},{append:t(()=>[a(H,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-created_at":t(e=>[a(h,{props:e},{default:t(()=>[v(i(c(ee)(e.row.created_at)),1),ne,P("small",re,i(c(ae)(e.row.created_at)),1)]),_:2},1032,["props"])]),"body-cell-to":t(e=>[a(h,{props:e},{default:t(()=>[e.row.amazonemails.length?C("",!0):(d(),w("span",ie,i(e.row.to),1)),e.row.amazonemails?(d(!0),w(S,{key:1},I(e.row.amazonemails,r=>(d(),w("span",{key:r.email},[v(i(r.email)+" ",1),a(le,{status:e.row.amazon_ses_status},null,8,["status"])]))),128)):C("",!0)]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[a(h,{props:e},{default:t(()=>[a(T,{onClick:r=>j(e.row),icon:"visibility",flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})],64))}});export{be as _};
