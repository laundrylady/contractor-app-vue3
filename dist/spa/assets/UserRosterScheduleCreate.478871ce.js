import{a as A,Q as E}from"./QToolbarTitle.a19fbe89.js";import{Q as J}from"./QSpace.8da48267.js";import{A as j,r as c,B as F,i as H,o as L,E as oe,m as n,K as O,L as m,Q as G,l as o,R as I,b8 as S,U as v,G as T,S as x,bp as K,q as d,af as te,n as i,F as Q,b7 as C,y as U,M as P,ae as se,aD as z,N as W}from"./index.fbd59a76.js";import{Q as V}from"./QSelect.5b5bbc87.js";import{C as Y}from"./ClosePopup.117d0adb.js";import{u as X,r as f}from"./index.esm.b35330f2.js";import{a as k,m as ae}from"./axios.b71dd2ad.js";import{u as w}from"./debug.805a8aef.js";import{o as ue,p as h,b as de,q as Z}from"./help.24013814.js";import{a as ee}from"./helpers.3afbd4d2.js";import{_ as ne}from"./DateField.33bf04e7.js";const re={class:"row q-col-gutter-md"},ie={class:"row q-col-gutter-md"},ce={class:"col-xs-12 col-sm-6"},me=d("div",{class:"q-mb-sm"},"Start and end times",-1),pe={class:"row q-col-gutter-md q-mb-md"},_e={class:"col-xs-12 col-sm-6"},ve=d("div",{class:"q-mb-sm"},"Capacity for this timeslot:",-1),ge={key:0,class:"row q-col-gutter-md"},fe={key:0},Ee=j({__name:"UserRosterScheduleEdit",setup(le){const y=c(!1),t=F({id:null,day:null,start_time:null,end_time:null,active:!0,user_id:null,user:null,user_postcoderegion_group_id:null,capacity:{products:[]}}),p=c(!1),b=c(),q=c(),g=H("bus"),_=c(),u=X({user_postcoderegion_group_id:{required:f},day:{required:f},start_time:{required:f},end_time:{required:f}},t),M=()=>{_.value=!1,p.value=!0,k.put(`/userrosterschedule/${t.id}`,t).then(()=>{de("positive","Schedule updated"),g.emit("getSchedule"),y.value=!1,p.value=!1}).catch(r=>{p.value=!1,_.value=r.response.data,w(r)})},$=r=>r?h.filter(a=>a.value>r&&a.value<=r+3):h,B=r=>{r.qty||(r.qty=0)};return L(()=>{g.on("editUserRosterSchedule",async r=>{b.value=await ee(),k.get(`/userrosterschedule/${r}`).then(a=>{Object.assign(t,a.data),k.get(`/userpostcoderegiongroup/index/${t.user_id}`).then(e=>{q.value=e.data.map(l=>({value:l.id,label:l.name}))}).catch(e=>{w(e)}),y.value=!0}).catch(a=>{w(a)})})}),oe(()=>{g.off("editUserRosterSchedule")}),(r,a)=>(n(),O(z,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e)},{default:m(()=>[t.day&&t.user?(n(),O(G,{key:0,class:"modal"},{default:m(()=>[o(E,null,{default:m(()=>[o(A,null,{default:m(()=>[I(S(v(ue)(t.day,"dddd DD/MM/YYYY"))+" - "+S(t.user.fullname),1)]),_:1}),o(J),T(o(x,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),o(K),o(P,null,{default:m(()=>[d("div",re,[o(V,{modelValue:t.user_postcoderegion_group_id,"onUpdate:modelValue":a[0]||(a[0]=e=>t.user_postcoderegion_group_id=e),label:"Select the pickup area",options:q.value,"map-options":"","emit-value":"",error:v(u).user_postcoderegion_group_id.$invalid,filled:"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options","error"])]),d("div",ie,[d("div",ce,[me,d("div",pe,[o(V,{modelValue:t.start_time,"onUpdate:modelValue":a[1]||(a[1]=e=>t.start_time=e),outlined:"",dense:"",options:v(h),"map-options":"","emit-value":"",label:"Start Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"]),o(V,{modelValue:t.end_time,"onUpdate:modelValue":a[2]||(a[2]=e=>t.end_time=e),outlined:"",dense:"",options:$(t.start_time),"map-options":"","emit-value":"",label:"End Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"])]),o(te,{modelValue:t.active,"onUpdate:modelValue":a[3]||(a[3]=e=>t.active=e),label:"Active"},null,8,["modelValue"])]),d("div",_e,[ve,t.capacity.products?(n(),i("div",ge,[(n(!0),i(Q,null,C(t.capacity.products,(e,l)=>(n(),i("div",{key:l,class:"col-xs-12 col-sm-6"},[o(W,{modelValue:e.qty,"onUpdate:modelValue":s=>e.qty=s,outlined:"",dense:"",label:v(Z)(e.product_category_id,b.value),"options-cover":"",onBlur:s=>B(e),class:"q-mb-md"},null,8,["modelValue","onUpdate:modelValue","label","onBlur"])]))),128))])):U("",!0)])]),_.value?(n(),i("div",fe,[d("ul",null,[(n(!0),i(Q,null,C(_.value.errors,(e,l)=>(n(),i("li",{key:l,class:"text-negative"},S(e.message),1))),128))])])):U("",!0)]),_:1}),o(se,{align:"right"},{default:m(()=>[T(o(x,{label:"Cancel",flat:"",color:"secondary"},null,512),[[Y]]),o(x,{disable:p.value||v(u).$invalid,label:"Update",color:"primary",onClick:a[4]||(a[4]=e=>M()),loading:p.value},null,8,["disable","loading"])]),_:1})]),_:1})):U("",!0)]),_:1},8,["modelValue"]))}}),ye={class:"row q-col-gutter-md q-mb-lg"},be={class:"col-xs-12 col-sm-6"},Ve={class:"row q-col-gutter-md"},he={class:"col-xs-12 col-sm-6"},qe=d("div",{class:"q-mb-sm"},"Start and end times",-1),$e={class:"row q-col-gutter-md"},Se={class:"col-xs-12 col-sm-6"},xe=d("div",{class:"q-mb-sm"},"Capacity for this timeslot:",-1),Ue={key:0,class:"row q-col-gutter-md"},ke={key:0},we={class:"q-mt-lg flex"},Je=j({__name:"UserRosterScheduleCreate",setup(le){const y=c(),t=H("bus"),p=c(!1),b=c(),q=c(),g=c(),_=c(!1),D={user_id:null,day:null,start_time:null,end_time:null,active:!0,user_postcoderegion_group_id:null,capacity:{products:[]}},u=F(JSON.parse(JSON.stringify(D))),$=X({user_id:{required:f},day:{required:f},start_time:{required:f},end_time:{required:f},user_postcoderegion_group_id:{required:f}},u,{$scope:!1}),B=()=>{g.value=!1,_.value=!0,k.post("/userrosterschedule",u).then(()=>{t.emit("getSchedule"),p.value=!1,_.value=!1}).catch(e=>{_.value=!1,g.value=e.response.data,w(e)})},r=e=>e?h.filter(l=>l.value>e&&l.value<=e+3):h,a=e=>{e.qty||(e.qty=0)};return L(async()=>{t.on("newUserRosterSchedule",async e=>{y.value=e.user,g.value=null,b.value=await ee(),k.get(`/userpostcoderegiongroup/index/${y.value.id}`).then(l=>{q.value=l.data.map(s=>({value:s.id,label:s.name}))}).catch(l=>{w(l)}),Object.assign(u,JSON.parse(JSON.stringify(D)));for(const l of b.value)u.capacity.products.push({product_category_id:l.value,qty:0});u.day=ae(e.day).format("DD/MM/YYYY"),u.user_id=y.value.id,p.value=!0})}),(e,l)=>(n(),O(z,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=s=>p.value=s)},{default:m(()=>[o(G,{class:"modal"},{default:m(()=>[o(E,null,{default:m(()=>[o(A,null,{default:m(()=>[I("Add a new "+S(e.$t("schedule.name"))+" entry",1)]),_:1}),o(J),T(o(x,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),o(K),o(P,null,{default:m(()=>[d("div",ye,[o(V,{modelValue:u.user_postcoderegion_group_id,"onUpdate:modelValue":l[0]||(l[0]=s=>u.user_postcoderegion_group_id=s),label:"Select the pickup area",options:q.value,"map-options":"","emit-value":"",error:v($).user_postcoderegion_group_id.$invalid,filled:"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options","error"]),d("div",be,[o(ne,{modelValue:u.day,"onUpdate:modelValue":l[1]||(l[1]=s=>u.day=s),label:"Date",invalid:v($).day.$invalid,outlined:!0},null,8,["modelValue","invalid"])])]),d("div",Ve,[d("div",he,[qe,d("div",$e,[o(V,{modelValue:u.start_time,"onUpdate:modelValue":l[2]||(l[2]=s=>u.start_time=s),outlined:"",dense:"",options:v(h),"map-options":"","emit-value":"",label:"Start Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"]),o(V,{modelValue:u.end_time,"onUpdate:modelValue":l[3]||(l[3]=s=>u.end_time=s),outlined:"",dense:"",options:r(u.start_time),"map-options":"","emit-value":"",label:"End Time","options-cover":"",class:"col-xs-12 col-sm-6"},null,8,["modelValue","options"])])]),d("div",Se,[xe,u.capacity.products?(n(),i("div",Ue,[(n(!0),i(Q,null,C(u.capacity.products,(s,N)=>(n(),i("div",{key:N,class:"col-xs-12 col-sm-6"},[o(W,{modelValue:s.qty,"onUpdate:modelValue":R=>s.qty=R,outlined:"",dense:"",label:v(Z)(s.product_category_id,b.value),"options-cover":"",onBlur:R=>a(s),class:"q-mb-md"},null,8,["modelValue","onUpdate:modelValue","label","onBlur"])]))),128))])):U("",!0)])]),g.value?(n(),i("div",ke,[d("ul",null,[(n(!0),i(Q,null,C(g.value.errors,(s,N)=>(n(),i("li",{key:N,class:"text-negative"},S(s.message),1))),128))])])):U("",!0),d("div",we,[o(x,{onClick:l[4]||(l[4]=s=>B()),disable:v($).$invalid||_.value,icon:"add_circle",label:"Add",color:"primary",class:"full-width",loading:_.value},null,8,["disable","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{Ee as _,Je as a};
