import{A,r as p,B as D,o as L,J as U,m as c,K as m,L as a,l as t,q as b,O as _,N as H,t as M,Q as T,U as z,R as v,ai as h,y as P,S as O,G as C}from"./index.7da93179.js";import{a as E,Q as $}from"./QBreadcrumbs.96094532.js";import{Q as F}from"./QSpace.2d911a61.js";import{Q as G}from"./QSelect.0342b451.js";import{Q as J}from"./QHeader.9f36f572.js";import{Q as K,a as i}from"./QTable.01150601.js";import{Q as V,a as B}from"./QItem.642560fa.js";import{Q as j}from"./QList.709f4980.js";import{Q as W}from"./QMenu.00781621.js";import{Q as X}from"./QPage.e25f8b02.js";import{Q as Y,a as Z}from"./QLayout.bec178d3.js";import{C as q}from"./ClosePopup.42f5b568.js";import{a as S}from"./axios.07c7c7d9.js";import{_ as ee}from"./StateField.ccb757aa.js";import{_ as ae}from"./PostcodeRegionDisplay.128d2d33.js";import{_ as te}from"./StatusTag.c958dd1f.js";import{_ as oe}from"./UserAvatar.41db8b9e.js";import{u as x}from"./debug.9f3fb657.js";import{o as I,s as le,r as re,a as se}from"./help.4068c5a1.js";import{u as ne}from"./vue-i18n.runtime.esm-bundler.dc0339a7.js";import"./rtl.ba9e3bff.js";import"./format.3e32b8d9.js";import"./QResizeObserver.66f1c4a6.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./QBadge.d2d220ed.js";const ie={class:"q-pl-md q-pt-sm q-pr-md q-pb-sm flex items-center",style:{"padding-top":"11px"}},ue={class:"text-h6",style:{"line-height":"1.1rem"}},de={class:"text-grey"},He=A({__name:"ContractorManagement",setup(ce){const w=ne(),y=p(),Q=p(null),g=p(!1),r=D({keyword:null,type:"contractor",status:"active",role:"contractor",state:null,contractor_status:"active"}),N=[{name:"avatar",label:"",align:"center",field:"avatar",sortable:!1,style:"width:65px"},{name:"first_name",label:w.t("contractor.nameColumn"),align:"left",field:"first_name",sortable:!0},{name:"postcoderegionsuburb",sortable:!1,label:`Home ${w.t("address.suburb")}`,field:"postcoderegionsuburb",align:"left"},{name:"contractor_status",sortable:!0,label:"Status",field:"contractor_status",align:"left"},{name:"enabled",sortable:!0,label:"Can Sign In",field:"enabled",align:"left"},{label:"Actions",name:"actions",sortable:!1,field:"actions"}],s=p({page:1,rowsNumber:I(),rowsPerPage:I(),sortBy:"first_name",descending:!1}),u=(l=null)=>{let o,n,e,d;l&&l.pagination?(o=l.pagination.page,n=l.pagination.rowsPerPage,e=l.pagination.sortBy,d=l.pagination.descending):(o=s.value.page,n=s.value.rowsPerPage,e=s.value.sortBy,d=s.value.descending),g.value=!0,S.post(`/user/datatable/${o}`,{sortBy:e,sort_order:d?"desc":"asc",skip:o,rowsPerPage:n,keyword:r.keyword,status:r.status,role:r.role,state:r.state,contractor_status:r.contractor_status}).then(f=>{var k;y.value=f.data.rows,g.value=!1,le(n),s.value.rowsNumber=f.data.total,s.value.page=o,s.value.rowsPerPage=n,s.value.sortBy=e,s.value.descending=d,l&&((k=Q.value)==null||k.scrollIntoView({behavior:"smooth",block:"center"}))}).catch(f=>{x(f)})},R=l=>{se("This will remove the contractor permenantly").onOk(()=>{S.delete(`/user/${l}`).then(()=>{u()}).catch(o=>{x(o)})})};return L(()=>{u()}),(l,o)=>{const n=U("router-link");return c(),m(Y,{view:"lHh LpR fFf",container:"",class:"layout-height"},{default:a(()=>[t(J,{class:M({"page-title text-black":!l.$q.dark.isActive,"bg-dark":l.$q.dark.isActive}),bordered:""},{default:a(()=>[b("div",ie,[t(E,null,{separator:a(()=>[t(_,{size:"1.5em",name:"chevron_right"})]),default:a(()=>[t($,{label:"Home",icon:"home",to:{name:"appDashboard"}}),t($,{label:l.$t("contractor.namePlural"),to:{name:"contractors"}},null,8,["label"])]),_:1}),t(H,{modelValue:r.keyword,"onUpdate:modelValue":o[0]||(o[0]=e=>r.keyword=e),debounce:500,placeholder:`Search ${l.$t("contractor.namePlural").toLowerCase()}`,dense:"",borderless:"",class:"q-ml-lg",clearable:""},{prepend:a(()=>[t(_,{name:"search"})]),_:1},8,["modelValue","placeholder"]),t(F),t(G,{modelValue:r.contractor_status,"onUpdate:modelValue":[o[1]||(o[1]=e=>r.contractor_status=e),o[2]||(o[2]=e=>u(null))],options:[{label:"Active",value:"active"},{label:"Paused",value:"paused"},{label:"Archived",value:"archived"}],label:l.$t("contractor.status"),"emit-value":"","map-options":"",dense:"",outlined:"",class:"q-mr-xs"},null,8,["modelValue","label"]),t(ee,{modelValue:r.state,"onUpdate:modelValue":[o[3]||(o[3]=e=>r.state=e),o[4]||(o[4]=e=>u(null))],label:"State",outlined:!0,dense:!0},null,8,["modelValue"])])]),_:1},8,["class"]),t(Z,null,{default:a(()=>[t(X,{padding:""},{default:a(()=>[b("div",{ref_key:"topRef",ref:Q},null,512),t(T,null,{default:a(()=>[t(K,{rows:y.value,columns:N,"row-key":"id",filter:r.keyword,loading:g.value,pagination:s.value,"onUpdate:pagination":o[5]||(o[5]=e=>s.value=e),onRequest:u,class:"no-shadow","rows-per-page-options":z(re),"wrap-cells":""},{"body-cell-avatar":a(e=>[t(i,{props:e},{default:a(()=>[t(oe,{user:e.row},null,8,["user"])]),_:2},1032,["props"])]),"body-cell-first_name":a(e=>[t(i,{props:e},{default:a(()=>[b("div",ue,[t(n,{to:{name:"contractor-dashboard",params:{id:e.row.id}},class:"link"},{default:a(()=>[v(h(e.row.fullname),1)]),_:2},1032,["to"])]),b("div",de,h(e.row.email),1)]),_:2},1032,["props"])]),"body-cell-contractor_status":a(e=>[t(i,{props:e},{default:a(()=>[t(te,{status:e.row.contractor_status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-postcoderegionsuburb":a(e=>[t(i,{props:e},{default:a(()=>[e.row.postcoderegionsuburb?(c(),m(ae,{key:0,postcoderegions:[e.row.postcoderegionsuburb]},null,8,["postcoderegions"])):P("",!0)]),_:2},1032,["props"])]),"body-cell-enabled":a(e=>[t(i,{props:e},{default:a(()=>[e.row.enabled?(c(),m(_,{key:0,name:"check",size:"24px"})):P("",!0)]),_:2},1032,["props"])]),"body-cell-actions":a(e=>[t(i,{props:e},{default:a(()=>[t(O,{flat:"",icon:"more_vert"},{default:a(()=>[t(W,null,{default:a(()=>[t(j,null,{default:a(()=>[C((c(),m(V,{clickable:"",to:{name:"contractor-edit",params:{id:e.row.id}}},{default:a(()=>[t(B,null,{default:a(()=>[v("Edit record")]),_:1})]),_:2},1032,["to"])),[[q]]),C((c(),m(V,{clickable:"",onClick:d=>R(e.row.id)},{default:a(()=>[t(B,null,{default:a(()=>[v("Delete")]),_:1})]),_:2},1032,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{He as default};
