import{Q as x,_ as k}from"./QEditor.13b04ec6.js";import{Q as B}from"./QSelect.5b5bbc87.js";import{A as j,i as E,r as p,B as w,o as A,m as v,K as M,L as f,l as n,q as r,b8 as _,N as T,U as c,n as Q,R as D,y,M as R,S as $,ae as H,Q as I}from"./index.fbd59a76.js";import{u as K,r as s}from"./index.esm.b35330f2.js";import{u as L}from"./use-quasar.1140b8ec.js";import{a as b}from"./axios.b71dd2ad.js";import{u as V}from"./debug.805a8aef.js";import{b as O}from"./help.24013814.js";import"./QToolbarTitle.a19fbe89.js";import"./QTable.1191bda5.js";import"./QList.eaa15994.js";import"./QMarkupTable.e4b2956c.js";import"./QLinearProgress.457e2dab.js";import"./ClosePopup.117d0adb.js";import"./QBadge.3656646d.js";import"./QBtnGroup.bdc458fc.js";import"./format.c926bd4b.js";import"./QItemSection.e2ef8c04.js";import"./rtl.af167dee.js";const z=r("div",{class:"text-h6 q-mb-md"},"Send Notification",-1),F={key:0,class:"bg-positive text-white q-pa-md q-mt-md"},G=j({__name:"SendNotificationUser",props:{cc:null,notificationUser:null},setup(a){const l=a,m=L(),S=E("bus"),u=p(),U=p(),g=p(),h={user_id:l.notificationUser.id,notification_template_id:null,notifiable_id:l.notificationUser.id,notifiable_type:"User",html:"",subject:null,cc:l.cc||[]},t=w(h),d=K({user_id:{required:s},notifiable_id:{required:s},notifiable_type:{required:s},subject:{required:s},html:{required:s}},t),C=()=>{u.value=null,Object.assign(t,h)},N=()=>{if(!t.notification_template_id){t.subject=null,t.html="";return}b.get(`/notificationtemplate/${t.notification_template_id}`).then(i=>{i.data.content?(t.html=i.data.content,t.subject=i.data.subject):U.value=""})},q=()=>{m.loading.show({message:"Queuing emails for sending..."}),b.post("/notification/sendsingle",t).then(i=>{O("positive","Emails queued for sending"),m.loading.hide(),u.value=i.data,S.emit("getNotifications"),t.subject=null,t.html=""}).catch(i=>{V(i),m.loading.hide()})};return A(()=>{b.get("/notificationtemplate/index").then(i=>{g.value=[{value:null,label:"Select a template"}].concat(i.data.map(e=>({value:e.id,label:e.name})))}).catch(i=>{V(i)})}),(i,e)=>(v(),M(I,null,{default:f(()=>[n(R,null,{default:f(()=>[z,r("p",null,"Send a notification to "+_(a.notificationUser.email)+".",1),n(B,{modelValue:t.notification_template_id,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.notification_template_id=o),e[1]||(e[1]=o=>N())],options:g.value,"emit-value":"","map-options":"",label:"Template",outlined:"",class:"q-mb-md"},null,8,["modelValue","options"]),n(T,{modelValue:t.subject,"onUpdate:modelValue":e[2]||(e[2]=o=>t.subject=o),label:"Subject",error:c(d).subject.$invalid,onBlur:e[3]||(e[3]=o=>c(d).subject.$touch())},null,8,["modelValue","error"]),n(x,{modelValue:t.html,"onUpdate:modelValue":e[4]||(e[4]=o=>t.html=o),label:"Content",error:c(d).html.$invalid},null,8,["modelValue","error"]),u.value?(v(),Q("div",F,[D(" Email sent to "),r("strong",null,_(u.value.email),1)])):y("",!0)]),_:1}),n(H,{align:"right"},{default:f(()=>[n($,{onClick:e[5]||(e[5]=o=>C()),color:"secondary",label:"Reset"}),n($,{onClick:e[6]||(e[6]=o=>q()),disable:c(d).$invalid,label:"Send",color:"primary",icon:"send"},null,8,["disable"])]),_:1})]),_:1}))}}),J={key:0},P=r("div",{class:"text-h5"},"Email Activities",-1),vt=j({__name:"ContractorNotification",props:{model:null},setup(a){return(l,m)=>a.model.id?(v(),Q("div",J,[P,r("p",null,"Send an Email or view the history for this "+_(l.$t("contractor.name"))+".",1),n(G,{"notification-user":a.model,class:"q-mb-lg"},null,8,["notification-user"]),n(k,{notifiable_id:a.model.id,notifiable_type:"User"},null,8,["notifiable_id"])])):y("",!0)}});export{vt as default};
