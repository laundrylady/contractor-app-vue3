import{_ as w}from"./GlobalNotifications.42557f9a.js";import{Q as A}from"./QSelect.0342b451.js";import{A as q,i as U,r as f,B as M,o as O,m as o,K as D,L as _,l as a,N as F,U as b,n,R as j,q as d,F as N,b1 as Q,y as g,M as J,S,ae as L,Q as R,ai as u}from"./index.7da93179.js";import{Q as H}from"./QEditor.029e164b.js";import{u as I,r as v}from"./index.esm.0811bb15.js";import{u as K}from"./use-quasar.41dfdbfa.js";import{a as h}from"./axios.07c7c7d9.js";import{u as k}from"./debug.9f3fb657.js";import{d as z}from"./help.4068c5a1.js";import"./QToolbarTitle.8a26e038.js";import"./QTable.01150601.js";import"./QList.709f4980.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./ClosePopup.42f5b568.js";import"./QBadge.d2d220ed.js";import"./QItem.642560fa.js";import"./rtl.ba9e3bff.js";import"./QMenu.00781621.js";import"./format.3e32b8d9.js";import"./QBtnGroup.17d5a1bd.js";const G=d("div",{class:"text-h6 q-mb-md"},"Send Notification",-1),P={key:0,class:"q-pa-md"},W={key:1,class:"bg-positive text-white q-pa-md q-mt-md"},X=q({__name:"SendNotificationTeam",props:{notifiable_id:null,team:null},setup(s){const r=s,c=K(),x=U("bus"),m=f(),C=f(),$=f(),y={notification_template_id:null,notifiable_id:r.notifiable_id,notifiable_type:"Team",html:"",subject:null},i=M(y),V=f(),p=I({notifiable_id:{required:v},notifiable_type:{required:v},subject:{required:v},html:{required:v}},i),B=()=>{m.value=null,Object.assign(i,JSON.parse(JSON.stringify(y)))},E=()=>{if(!i.notification_template_id){i.subject=null,i.html="";return}h.get(`/notificationtemplate/${i.notification_template_id}`).then(l=>{l.data.content?(i.html=l.data.content,i.subject=l.data.subject):C.value=""})},T=()=>{c.loading.show({message:"Queuing emails for sending..."}),h.post("/notification/sendteam",i).then(l=>{z("positive","Emails queued for sending"),c.loading.hide(),m.value=l.data,x.emit("getNotifications"),i.subject=null,i.html=""}).catch(l=>{k(l),c.loading.hide()})};return O(()=>{const l=[];r.team.users&&(r.team.users.forEach(e=>{e.user.email_notifications&&l.push(e.user)}),V.value=l),h.get("/notificationtemplate/index").then(e=>{$.value=[{value:null,label:"Select a template"}].concat(e.data.map(t=>({value:t.id,label:t.name})))}).catch(e=>{k(e)})}),(l,e)=>(o(),D(R,null,{default:_(()=>[a(J,null,{default:_(()=>[G,a(A,{modelValue:i.notification_template_id,"onUpdate:modelValue":[e[0]||(e[0]=t=>i.notification_template_id=t),e[1]||(e[1]=t=>E())],options:$.value,"emit-value":"","map-options":"",label:"Template",outlined:"",class:"q-mb-md"},null,8,["modelValue","options"]),a(F,{modelValue:i.subject,"onUpdate:modelValue":e[2]||(e[2]=t=>i.subject=t),label:"Subject",error:b(p).subject.$invalid,onBlur:e[3]||(e[3]=t=>b(p).subject.$touch())},null,8,["modelValue","error"]),a(H,{modelValue:i.html,"onUpdate:modelValue":e[4]||(e[4]=t=>i.html=t),label:"Content",error:b(p).html.$invalid},null,8,["modelValue","error"]),!m.value||!m.value.length?(o(),n("div",P,[j(" An email will be sent to the following members: "),d("ul",null,[(o(!0),n(N,null,Q(V.value,t=>(o(),n("li",{key:t.id},u(t.fullname)+" ("+u(t.email)+") ",1))),128))])])):g("",!0),m.value?(o(),n("div",W,[j(" Email sent to: "),(o(!0),n(N,null,Q(m.value,t=>(o(),n("div",{key:t.id},[d("strong",null,u(t.user.fullname)+" ("+u(t.user.email)+")",1)]))),128))])):g("",!0)]),_:1}),a(L,{align:"right"},{default:_(()=>[a(S,{onClick:e[5]||(e[5]=t=>B()),color:"secondary",label:"Reset"}),a(S,{onClick:e[6]||(e[6]=t=>T()),disable:b(p).$invalid,label:"Send",color:"primary"},null,8,["disable"])]),_:1})]),_:1}))}}),Y={key:0},Z=d("div",{class:"text-h5"},"Email Activities",-1),je=q({__name:"TeamNotifications",props:{model:null},setup(s){return(r,c)=>s.model.id?(o(),n("div",Y,[Z,d("p",null,"Send an Email or view the history for this "+u(r.$t("team.name"))+".",1),a(X,{team:s.model,notifiable_id:s.model.id,class:"q-mb-lg"},null,8,["team","notifiable_id"]),a(w,{notifiable_id:s.model.id,notifiable_type:"Team"},null,8,["notifiable_id"])])):g("",!0)}});export{je as default};
