import{A as $,r as b,o as C,w as _,m as s,K as k,L as m,l as r,O as x,af as I,y as v,n as f,q as S,ai as y,u as N,ah as F,R as B,S as P,F as U}from"./index.7da93179.js";import{Q as q}from"./QSelect.0342b451.js";import{a as g}from"./axios.07c7c7d9.js";import{u as V}from"./debug.9f3fb657.js";import{Q as O}from"./QLinearProgress.6e390987.js";import{Q as T,a as A}from"./QItem.642560fa.js";import{Q as L}from"./rtl.ba9e3bff.js";import{_ as Q}from"./UserAvatar.41db8b9e.js";const ee=$({__name:"TeamField",props:{modelValue:null,status:null,invalid:{type:Boolean},label:null,dark:{type:Boolean},outlined:{type:Boolean},disabled:{type:Boolean},multiple:{type:Boolean},dense:{type:Boolean},borderless:{type:Boolean},filled:{type:Boolean},placeholder:null,nowatch:{type:Boolean}},emits:["update:modelValue"],setup(l,{emit:h}){const t=l,u=b(!1),n=b(),c=o=>{h("update:modelValue",o)},p=(o,i)=>{o.length<2||(u.value=!0,g.post(`/team/index?status=${t.status}`,{keyword:o}).then(e=>{i(()=>{n.value=e.data.map(d=>({value:d.id,label:d.name})),u.value=!1})}).catch(e=>{u.value=!1,V(e)}))};return C(()=>{t.modelValue&&(Array.isArray(t.modelValue)&&t.modelValue.length||!Array.isArray(t.modelValue))&&g.get(`/team/${t.modelValue}`).then(o=>{Array.isArray(o.data)?(n.value=o.data.map(i=>({value:i.id,label:i.name})),u.value=!1):(n.value=[{value:o.data.id,label:o.data.name}],u.value=!1)})}),_(()=>t.modelValue,(o,i)=>{!t.nowatch&&o&&o!==i&&(Array.isArray(o)&&o.length||!Array.isArray(o))&&g.get(`/team/${o}`).then(e=>{n.value=[{value:e.data.id,label:e.data.name}]}).catch(e=>{V(e)})}),(o,i)=>(s(),k(q,{label:l.label,"model-value":l.modelValue,"onUpdate:modelValue":c,options:n.value,onFilter:p,"use-input":"","emit-value":"","map-options":"",dark:l.dark,color:l.dark?"white":"",error:l.invalid,"hide-dropdown-icon":"","input-debounce":"350",autocomplete:"team-filter",outlined:l.outlined,disable:l.disabled,"use-chips":"",ref:"qSelectTeam",borderless:l.borderless,dense:l.dense,class:"q-pb-none",filled:l.filled,loading:u.value,multiple:l.multiple,placeholder:l.placeholder},{prepend:m(()=>[r(x,{name:"group",color:"info"})]),loading:m(()=>[u.value?(s(),k(I,{key:0})):v("",!0)]),_:1},8,["label","model-value","options","dark","color","error","outlined","disable","borderless","dense","filled","loading","multiple","placeholder"]))}}),M={key:0,style:{"min-height":"100px"}},R=S("div",{class:"q-ml-sm q-mt-sm"},"Finding available contractors...",-1),w={key:1},D={class:"text-h6 q-mb-xs"},J={key:0},z={key:1},E={key:0},ae=$({__name:"OrderContractorManagement",props:{modelValue:null,team_id:null,scheduled_pickup_date:null,scheduled_pickup_time:null,productcategories:null,disabled:{type:Boolean},reassign:{type:Boolean}},emits:["update:modelValue"],setup(l,{emit:h}){const t=l,u=b(!1),n=b(),c=b(),p=()=>{u.value=!0,g.post("/team/availablecontractors",{team_id:t.team_id,scheduled_pickup_date:t.scheduled_pickup_date,scheduled_pickup_time:t.scheduled_pickup_time,productcategories:t.productcategories}).then(e=>{c.value=e.data,u.value=!1,n.value&&(e.data.find(d=>d.id===n.value)||(h("update:modelValue",null),n.value=null))})},o=()=>{h("update:modelValue",n)},i=()=>{n.value=null,h("update:modelValue",null),p()};return C(()=>{n.value=null,t.modelValue?g.get(`/user/${t.modelValue}`).then(e=>{c.value=[e.data],n.value=e.data.id}).catch(e=>{V(e)}):p()}),_(()=>t.scheduled_pickup_date,e=>{e&&t.scheduled_pickup_time&&p()}),_(()=>t.scheduled_pickup_time,e=>{e&&t.scheduled_pickup_date&&p()}),_(()=>t.productcategories,(e,d)=>{e&&d&&JSON.stringify(e)!==JSON.stringify(d)&&p()}),(e,d)=>(s(),f(U,null,[u.value?(s(),f("div",M,[u.value?(s(),k(O,{key:0,indeterminate:""})):v("",!0),R])):v("",!0),c.value&&!u.value?(s(),f("div",w,[S("div",D,[l.modelValue?v("",!0):(s(),f("div",J,"Available "+y(e.$t("contractor.namePlural"))+" ("+y(c.value.length)+")",1)),l.modelValue?(s(),f("div",z,"Assigned "+y(e.$t("contractor.name")),1)):v("",!0)]),r(q,{modelValue:n.value,"onUpdate:modelValue":[d[0]||(d[0]=a=>n.value=a),d[1]||(d[1]=a=>o())],label:e.$t("order.contractorUserId"),options:c.value.map(a=>({value:a.id,label:a.fullname,avatar:a.avatar,first_name:a.first_name,last_name:a.last_name,fullname:a.fullname})),"map-options":"","emit-value":"",outlined:"",disable:l.disabled,outline:""},{option:m(a=>[r(T,N(F(a.itemProps)),{default:m(()=>[r(A,{side:""},{default:m(()=>[r(Q,{user:{id:a.opt.value,first_name:a.opt.first_name,last_name:a.opt.last_name,fullname:a.opt.fullname,avatar:a.opt.avatar}},null,8,["user"])]),_:2},1024),r(A,null,{default:m(()=>[r(L,null,{default:m(()=>[B(y(a.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"selected-item":m(a=>[r(Q,{user:{id:a.opt.value,first_name:a.opt.first_name,last_name:a.opt.last_name,fullname:a.opt.fullname,avatar:a.opt.avatar},class:"q-mr-sm"},null,8,["user"]),B(" "+y(a.opt.label),1)]),_:1},8,["modelValue","label","options","disable"]),l.reassign&&l.modelValue?(s(),f("div",E,[r(P,{flat:"",onClick:d[2]||(d[2]=a=>i()),label:"Reassign",color:"primary",icon:"sync"})])):v("",!0)])):v("",!0)],64))}});export{ee as _,ae as a};
