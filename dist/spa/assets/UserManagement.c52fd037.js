import{A as W,I as X,r as p,B as Y,o as Z,m as i,n as D,l as a,L as t,aj as ee,F as I,K as m,M as ae,q as o,O as _,R as b,ai as g,y,G as Q,S as A,b1 as te,Q as L,t as le,N as se,U as oe}from"./index.7da93179.js";import{Q as M}from"./QSpace.2d911a61.js";import{a as C,Q as P}from"./QItem.642560fa.js";import{Q as E}from"./QList.709f4980.js";import{a as re,Q as B}from"./QBreadcrumbs.96094532.js";import{Q as ne}from"./QSelect.0342b451.js";import{Q as ie}from"./QHeader.9f36f572.js";import{Q as ue,a as f}from"./QTable.01150601.js";import{Q as de}from"./QMenu.00781621.js";import{Q as me}from"./QPage.e25f8b02.js";import{Q as ce,a as fe}from"./QLayout.bec178d3.js";import{C as $}from"./ClosePopup.42f5b568.js";import{a as v}from"./axios.07c7c7d9.js";import{_ as pe}from"./StateField.ccb757aa.js";import{_ as O}from"./PostcodeRegionDisplay.128d2d33.js";import{_ as be}from"./StatusTag.c958dd1f.js";import{_ as ge}from"./UserAvatar.41db8b9e.js";import{u as h}from"./debug.9f3fb657.js";import{l as _e,o as z,s as ve,r as he,a as S}from"./help.4068c5a1.js";import{u as ke}from"./vue-i18n.runtime.esm-bundler.dc0339a7.js";import"./rtl.ba9e3bff.js";import"./format.3e32b8d9.js";import"./QResizeObserver.66f1c4a6.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./QBadge.d2d220ed.js";const we={class:"flex items-start"},ye={class:"text-h6"},Qe={class:"q-mt-xs"},Ce={class:"text-h6 q-mt-lg"},Pe=o("p",null,"This user account has access to the following customer records.",-1),$e={class:"q-pl-md q-pt-sm q-pr-md q-pb-sm flex items-center",style:{"padding-top":"11px"}},Ve={class:"text-h6"},qe=["onClick"],xe=["onClick"],sa=W({__name:"UserManagement",setup(Be){const H=ke(),V=X(),T=p(),N=p(null),q=p(!1),u=p(),x=p(!1),r=Y({keyword:null,status:"active",role:null,state:null}),F=[{name:"avatar",label:"",align:"center",field:"avatar",sortable:!1,style:"width:65px"},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"first_name",label:"Name",align:"left",field:"first_name",sortable:!0},{name:"postcoderegionsuburb",sortable:!1,label:`Home ${H.t("address.suburb")}`,field:"postcoderegionsuburb",align:"left"},{name:"role",sortable:!0,label:"Type",field:"role",align:"left",format:l=>l?j[l]:""},{name:"current_sign_in_at",sortable:!0,label:"Last Signin",field:"current_sign_in_at",align:"left",format:l=>l?_e(l):""},{name:"enabled",sortable:!0,label:"Can Sign In",field:"enabled",align:"left"},{label:"Actions",name:"actions",sortable:!1,field:"actions"}],j={user:"Customer",contractor:"Contractor",admin:"Staff"},n=p({page:1,rowsNumber:z(),rowsPerPage:z(),sortBy:"first_name",descending:!1}),c=(l=null)=>{let s,e,d,k;l&&l.pagination?(s=l.pagination.page,e=l.pagination.rowsPerPage,d=l.pagination.sortBy,k=l.pagination.descending):(s=n.value.page,e=n.value.rowsPerPage,d=n.value.sortBy,k=n.value.descending),q.value=!0,v.post(`/user/datatable/${s}`,{sortBy:d,sort_order:k?"desc":"asc",skip:s,rowsPerPage:e,keyword:r.keyword,status:r.status,role:r.role,state:r.state}).then(w=>{var R;T.value=w.data.rows,q.value=!1,ve(e),n.value.rowsNumber=w.data.total,n.value.page=s,n.value.rowsPerPage=e,n.value.sortBy=d,n.value.descending=k,l&&((R=N.value)==null||R.scrollIntoView({behavior:"smooth",block:"center"}))}).catch(w=>{h(w)})},G=l=>{S("This will remove the user permenantly").onOk(()=>{v.delete(`/user/${l}`).then(()=>{c(null)}).catch(s=>{h(s)})})},K=l=>{l.enabled?S("This will disable access for this user").onOk(()=>{v.get(`/user/toggleenabled/${l.id}/0`).then(()=>{c(null)}).catch(s=>{h(s)})}):S("This will enable access for this user").onOk(()=>{v.get(`/user/toggleenabled/${l.id}/1`).then(()=>{c(null)}).catch(s=>{h(s)})})},U=l=>{l.role==="user"&&V.push({name:"team-dashboard",params:{id:l.current_team_id}}),l.role==="contractor"&&V.push({name:"contractor-dashboard",params:{id:l.id}}),l.role==="admin"&&window.open("https://myaccount.google.com/")},J=l=>{if(l.role==="contractor"){V.push({name:"contractor-dashboard",params:{id:l.id}});return}v.get(`/teamuser/teamsbyuserid/${l.id}`).then(s=>{u.value={user:l,teams:s.data},x.value=!0}).catch(s=>h(s))};return Z(()=>{c()}),(l,s)=>(i(),D(I,null,[a(ee,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=e=>x.value=e)},{default:t(()=>[u.value&&u.value.user?(i(),m(L,{key:0,class:"modal-sm"},{default:t(()=>[a(ae,null,{default:t(()=>[o("div",we,[o("div",null,[o("div",ye,[a(_,{name:u.value.role==="contractor"?"engineering":"group",class:"q-mr-sm"},null,8,["name"]),b(g(u.value.user.fullname),1)]),o("div",null,g(u.value.user.email),1),o("div",Qe,[u.value.user.postcoderegionsuburb?(i(),m(O,{key:0,postcoderegions:[u.value.user.postcoderegionsuburb]},null,8,["postcoderegions"])):y("",!0)])]),a(M),Q(a(A,{dense:"",round:"",icon:"close",flat:""},null,512),[[$]])]),o("div",Ce,[a(_,{name:"security",class:"q-mr-sm"}),b(" Record Access")]),Pe,a(E,{separator:"",dense:"",bordered:""},{default:t(()=>[(i(!0),D(I,null,te(u.value.teams,e=>(i(),m(P,{key:e.id,to:{name:"team-dashboard",params:{id:e.id}},clickable:""},{default:t(()=>[a(C,{class:"link"},{default:t(()=>[b(g(e.name),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"]),a(ce,{view:"lHh LpR fFf",container:"",class:"layout-height"},{default:t(()=>[a(ie,{class:le({"page-title text-black":!l.$q.dark.isActive,"bg-dark":l.$q.dark.isActive}),bordered:""},{default:t(()=>[o("div",$e,[a(re,null,{separator:t(()=>[a(_,{size:"1.5em",name:"chevron_right"})]),default:t(()=>[a(B,{label:"Home",icon:"home",to:{name:"appDashboard"}}),a(B,{label:"Settings",to:{name:"settings"}}),a(B,{label:"Users"})]),_:1}),a(se,{modelValue:r.keyword,"onUpdate:modelValue":s[1]||(s[1]=e=>r.keyword=e),debounce:500,placeholder:"Search users",dense:"",borderless:"",class:"q-ml-lg",clearable:""},{prepend:t(()=>[a(_,{name:"search"})]),_:1},8,["modelValue"]),a(M),a(ne,{modelValue:r.role,"onUpdate:modelValue":[s[2]||(s[2]=e=>r.role=e),s[3]||(s[3]=e=>c(null))],label:"Type",options:[{label:"Contractor",value:"contractor"},{label:"Customer",value:"user"},{label:"Staff",value:"admin"}],"map-options":"","emit-value":"",outlined:"",dense:"",class:"q-mr-sm",style:{width:"150px"}},null,8,["modelValue"]),a(pe,{modelValue:r.state,"onUpdate:modelValue":[s[4]||(s[4]=e=>r.state=e),s[5]||(s[5]=e=>c(null))],label:"State",outlined:!0,dense:!0},null,8,["modelValue"])])]),_:1},8,["class"]),a(fe,null,{default:t(()=>[a(me,{padding:""},{default:t(()=>[o("div",{ref_key:"topRef",ref:N},null,512),a(L,null,{default:t(()=>[a(ue,{rows:T.value,columns:F,"row-key":"id",filter:r.keyword,loading:q.value,pagination:n.value,"onUpdate:pagination":s[6]||(s[6]=e=>n.value=e),onRequest:c,class:"no-shadow","rows-per-page-options":oe(he)},{"body-cell-avatar":t(e=>[a(f,{props:e},{default:t(()=>[a(ge,{user:e.row},null,8,["user"])]),_:2},1032,["props"])]),"body-cell-email":t(e=>[a(f,{props:e},{default:t(()=>[o("div",Ve,[o("a",{class:"link",onClick:d=>J(e.row)},g(e.row.email),9,qe)])]),_:2},1032,["props"])]),"body-cell-first_name":t(e=>[a(f,{props:e},{default:t(()=>[o("a",{onClick:d=>U(e.row),class:"link"},g(e.row.fullname),9,xe)]),_:2},1032,["props"])]),"body-cell-contractor_status":t(e=>[a(f,{props:e},{default:t(()=>[a(be,{status:e.row.contractor_status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-postcoderegionsuburb":t(e=>[a(f,{props:e},{default:t(()=>[e.row.postcoderegionsuburb?(i(),m(O,{key:0,postcoderegions:[e.row.postcoderegionsuburb]},null,8,["postcoderegions"])):y("",!0)]),_:2},1032,["props"])]),"body-cell-enabled":t(e=>[a(f,{props:e},{default:t(()=>[e.row.enabled?(i(),m(_,{key:0,name:"check",size:"24px"})):y("",!0)]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[a(f,{props:e},{default:t(()=>[a(A,{flat:"",icon:"more_vert"},{default:t(()=>[a(de,null,{default:t(()=>[a(E,null,{default:t(()=>[Q((i(),m(P,{clickable:"",onClick:d=>K(e.row)},{default:t(()=>[a(C,null,{default:t(()=>[b(g(`${e.row.enabled?"Disable":"Enable"}`),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[$]]),Q((i(),m(P,{clickable:"",onClick:d=>U(e.row)},{default:t(()=>[a(C,null,{default:t(()=>[b("Edit record")]),_:1})]),_:2},1032,["onClick"])),[[$]]),Q((i(),m(P,{clickable:"",onClick:d=>G(e.row.id)},{default:t(()=>[a(C,null,{default:t(()=>[b("Delete")]),_:1})]),_:2},1032,["onClick"])),[[$]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}});export{sa as default};
