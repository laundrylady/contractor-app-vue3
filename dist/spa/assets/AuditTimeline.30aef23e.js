import{V as S,g as U,h as R,X as A,A as D,r as C,B as T,o as H,m as s,n as r,y as u,l as a,L as o,U as k,N as L,O as x,F as y,b7 as Q,G as O,bv as E,Q as F,K as B,b8 as n,R as h,q as m,S as K}from"./index.e647c85a.js";import{a as M,Q as V}from"./QTable.64a81add.js";import{a as N,Q as v}from"./QItemSection.99659658.js";import{Q as $}from"./QList.2f0afc60.js";import{a as j}from"./axios.ccd3a804.js";import{u as G}from"./debug.805a8aef.js";import{x as q,y as W,z as X,l as J,f as Y}from"./help.c0f85e41.js";var z=S({name:"QTr",props:{props:Object,noHover:Boolean},setup(c,{slots:g}){const p=U(()=>"q-tr"+(c.props===void 0||c.props.header===!0?"":" "+c.props.__trClass)+(c.noHover===!0?" q-tr--no-hover":""));return()=>R("tr",{class:p.value},A(g.default))}});const Z={key:0},ee=m("div",{class:"text-h5"},"Audit History",-1),te=m("p",null,"Below is the audit trail for the module.",-1),ae=[ee,te],oe={key:0},se={key:1},ne={key:2},re={class:"text-grey"},le={key:3,class:"text-bold"},ie={key:4},de={class:"text-capitalize text-grey-6"},ue={class:"text-capitalize text-grey-6"},ye=D({__name:"AuditTimeline",props:{auditable_id:null,auditable_type:null,nobox:{type:Boolean}},setup(c){const g=c,p=C(),b=C(!1),f=T({keyword:null,user_id:null}),I=[{name:"event",sortable:!0,label:"Event",field:"event",align:"left",format:l=>l.toUpperCase()},{name:"created_at",sortable:!0,label:"When",field:"created_at",align:"left"},{name:"user_id",sortable:!0,label:"User",field:"user_id",align:"left"},{name:"ip",sortable:!0,label:"IP",field:"ip",align:"left"}],_=T({page:1,rowsNumber:q(),rowsPerPage:q(),sortBy:"id",descending:!0}),P=(l=null)=>{let i,e,t,d;l&&l.pagination?(i=l.pagination.page,e=l.pagination.rowsPerPage,t=l.pagination.sortBy,d=l.pagination.descending):(i=_.page,e=_.rowsPerPage,t=_.sortBy,d=_.descending),b.value=!0,j.post(`/audit/datatable/${i}`,{sortBy:t,sort_order:d?"desc":"asc",skip:i,rowsPerPage:e,keyword:f.keyword,user_id:f.user_id,auditable_id:g.auditable_id,auditable:g.auditable_type}).then(w=>{_.rowsNumber=w.data.total,p.value=w.data.rows,b.value=!1,X(e)}).catch(w=>{G(w)})};return H(()=>{P()}),(l,i)=>(s(),r(y,null,[c.nobox?u("",!0):(s(),r("div",Z,ae)),a(F,null,{default:o(()=>[a(M,{rows:p.value,columns:I,"row-key":"id",filter:f.keyword,loading:b.value,pagination:_,"onUpdate:pagination":i[1]||(i[1]=e=>_=e),onRequest:P,"rows-per-page-options":k(W)},{"top-left":o(()=>[a(L,{modelValue:f.keyword,"onUpdate:modelValue":i[0]||(i[0]=e=>f.keyword=e),debounce:500,placeholder:"Keyword"},{append:o(()=>[a(x,{name:"search"})]),_:1},8,["modelValue"])]),body:o(e=>[a(z,{props:e},{default:o(()=>[(s(!0),r(y,null,Q(e.cols,t=>(s(),B(V,{key:t.name,props:e},{default:o(()=>[t.name==="user_id"&&e.row.user?(s(),r("span",oe,n(e.row.user.fullname),1)):u("",!0),t.name==="auditable"?(s(),r("span",se,n(e.row.auditable),1)):u("",!0),t.name==="created_at"?(s(),r("span",ne,[h(n(k(J)(e.row.created_at))+" - ",1),m("span",re,n(k(Y)(e.row.created_at)),1)])):u("",!0),t.name==="event"?(s(),r("span",le,[a(K,{size:"sm",color:"primary",round:"",dense:"",onClick:d=>e.expand=!e.expand,icon:e.expand?"remove":"add",class:"q-mr-xs"},null,8,["onClick","icon"]),h(" "+n(t.value)+" ("+n(e.row.changes.length)+")",1)])):u("",!0),t.name==="ip"?(s(),r("span",ie,n(t.value),1)):u("",!0)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"]),O(a(z,{props:e},{default:o(()=>[a(V,{colspan:"100%"},{default:o(()=>[a($,{dense:""},{default:o(()=>[e.row.event==="update"?(s(!0),r(y,{key:0},Q(e.row.changes,(t,d)=>(s(),B(N,{key:d},{default:o(()=>[a(v,{side:""},{default:o(()=>[a(x,{name:"chevron_right"})]),_:1}),a(v,null,{default:o(()=>[m("div",null,[m("strong",de,n(t.field),1),h(' changed from "'+n(t.oldValue)+'" to "'+n(t.value)+'" ',1)])]),_:2},1024)]),_:2},1024))),128)):u("",!0),e.row.event==="create"?(s(!0),r(y,{key:1},Q(e.row.changes,(t,d)=>(s(),B(N,{key:d},{default:o(()=>[a(v,{side:""},{default:o(()=>[a(x,{name:"chevron_right"})]),_:1}),a(v,null,{default:o(()=>[m("div",null,[m("strong",ue,n(t.field),1),h(' set to "'+n(t.value)+'"',1)])]),_:2},1024)]),_:2},1024))),128)):u("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[E,e.expand]])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})],64))}});export{ye as _};
