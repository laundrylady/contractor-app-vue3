import{A as X,r as u,g as Y,w as Q,o as R,J as T,m as d,n as g,q as r,l as v,L as b,O as C,K as V,af as ee,y as f,U as _,R as I,F as O,b1 as N,S as w,ai as le}from"./index.7da93179.js";import{Q as K}from"./QSelect.0342b451.js";import{Q as te}from"./QBadge.d2d220ed.js";import{a as M}from"./axios.07c7c7d9.js";import{u as F}from"./debug.9f3fb657.js";import{C as ae}from"./help.4068c5a1.js";const oe={key:0},se={class:"row q-col-gutter-md"},ne={class:"col-xs-12 col-sm-8"},ie={class:"row q-col-gutter-md"},de={class:"col-xs-12 col-sm-6"},ue={class:"col-xs-12 col-sm-6"},ce={key:0,class:"q-pt-sm q-pb-sm"},re=r("span",{class:"text-bold"},"Suggestions:",-1),me={key:2},ge={class:"q-mt-md"},ve={class:"col-xs-12 col-sm-4"},pe={key:0},fe={key:1,style:{"max-height":"600px","overflow-x":"none","overflow-y":"auto"},class:"bg-grey-1 q-pa-sm"},ye={class:"text-bold"},$e=X({__name:"PostcodeRegionMapField",props:{modelValue:null,invalid:{type:Boolean},label:null,dark:{type:Boolean},outlined:{type:Boolean},disabled:{type:Boolean},multiple:{type:Boolean},dense:{type:Boolean},borderless:{type:Boolean},filled:{type:Boolean},placeholder:null,nowatch:{type:Boolean},state:null,latLng:null,zoom:null,showMap:{type:Boolean},suggestionId:null},emits:["update:modelValue"],setup(a,{emit:G}){const t=a,k=u(!1),x=u(),L=u(),z=u(),S=u(),n=u([]),y=u(),m=u(!1),J=u(),$=u(),B=u(),P=u(),A=e=>{if(S.value&&!m.value){const l=new S.value.maps.Geocoder;m.value=!0,l.geocode({latLng:e.latLng},function(s,c){if(c==="OK"&&s[0]){const o=s[0].address_components.find(i=>i.types.indexOf("locality")!==-1).long_name,p=s[0].address_components.find(i=>i.types.indexOf("administrative_area_level_1")!==-1).short_name;o&&p&&M.get(`/public/postcoderegion/index?keyword=${o}&state=${p}`).then(i=>{i.data.length&&(!t.modelValue||!t.modelValue.find(W=>W.id===i.data[0].id))&&(n.value.push({latLng:{lat:e.latLng.lat(),lng:e.latLng.lng()},id:i.data[0].id}),h({id:i.data[0].id,locality:i.data[0].locality,state:i.data[0].state,postcode:i.data[0].postcode,lat:e.latLng.lat(),lng:e.latLng.lng()})),m.value=!1}).catch(i=>{F(i),m.value=!1})}})}},h=e=>{let l=JSON.parse(JSON.stringify(t.modelValue));l?l.push({id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,meta:{pivot_lat:e.lat,pivot_lng:e.lng}}):l=[{id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,meta:{pivot_lat:e.lat,pivot_lng:e.lng}}],G("update:modelValue",l)},U=e=>{let l=JSON.parse(JSON.stringify(t.modelValue));l=l.filter(s=>s.id!==e.id),n.value=n.value.filter(s=>s.id!==e.id),G("update:modelValue",l)},D=()=>{if(!x.value)return!1;for(const e of x.value.postcoderegions)(!t.modelValue||!t.modelValue.find(l=>l.id===e.id))&&setTimeout(()=>{h({id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,lat:e.meta.pivot_lat,lng:e.meta.pivot_lng}),n.value.push({latLng:{lat:parseFloat(e.meta.pivot_lat),lng:parseFloat(e.meta.pivot_lng)},id:e.id})},1);setTimeout(()=>{n.value&&(y.value=n.value[0].latLng)},1),L.value=12},q=Y(()=>{if(!$.value||!$.value.length||!t.modelValue)return[];const l=JSON.parse(JSON.stringify(t.modelValue)).map(s=>s.id);return $.value.filter(s=>l.indexOf(s.id)===-1)}),j=e=>{(!t.modelValue||!t.modelValue.find(l=>l.id===e.id))&&setTimeout(()=>{h({id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,lat:e.lat,lng:e.long}),n.value.push({latLng:{lat:parseFloat(e.lat),lng:parseFloat(e.long)},id:e.id})},1)},E=()=>{for(const e of q.value)(!t.modelValue||!t.modelValue.find(l=>l.id===e.id))&&setTimeout(()=>{h({id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,lat:e.lat,lng:e.long}),n.value.push({latLng:{lat:parseFloat(e.lat),lng:parseFloat(e.long)},id:e.id})},1)};Q(z,e=>{e&&e.$mapPromise.then(()=>{S.value=window.google})}),Q(()=>t.modelValue,e=>{(!e||!e.length)&&!n.value&&(n.value=[])});const Z=(e,l)=>{e.length<2||(m.value=!0,M.get(`/public/postcoderegion/index?keyword=${e}${t.state?`&state=${t.state}`:""}`).then(s=>{l(()=>{P.value=s.data.map(c=>(c.label=`${c.locality} (${c.state} ${c.postcode} - ${c.sa4})`,c)),m.value=!1})}).catch(s=>{m.value=!1,F(s)}))},H=e=>{(!t.modelValue||!t.modelValue.find(l=>l.id===e.id))&&setTimeout(()=>{h({id:e.id,locality:e.locality,state:e.state,postcode:e.postcode,lat:e.lat,lng:e.long}),n.value.push({latLng:{lat:parseFloat(e.lat),lng:parseFloat(e.long)},id:e.id}),y.value={lat:parseFloat(e.lat),lng:parseFloat(e.long)}},1),B.value=null};return R(()=>{if(k.value=t.showMap||!1,L.value=t.zoom||11,y.value=t.latLng,M.get(`/postcoderegiongroup/index?state=${t.state||""}`).then(e=>{J.value=e.data}).catch(e=>{F(e)}),t.modelValue)for(const e of t.modelValue)n.value.push({latLng:{lat:parseFloat(e.meta.pivot_lat),lng:parseFloat(e.meta.pivot_lng)},id:e.id}),n.value&&n.value.length&&(y.value=n.value[0].latLng,L.value=11);t.suggestionId&&M.get(`/public/postcoderegion/localitiesbydc/${t.suggestionId}`).then(e=>{$.value=e.data}).catch(e=>{F(e)})}),(e,l)=>{const s=T("GMapMarker"),c=T("GMapMap");return a.latLng?(d(),g("div",oe,[r("div",se,[r("div",ne,[r("div",ie,[r("div",de,[v(K,{modelValue:x.value,"onUpdate:modelValue":[l[0]||(l[0]=o=>x.value=o),D],options:J.value,"option-label":"name",label:"Load from group",outlined:"",clearable:""},{prepend:b(()=>[v(C,{name:"place"})]),_:1},8,["modelValue","options"])]),r("div",ue,[v(K,{label:"Search for a suburb",modelValue:B.value,"onUpdate:modelValue":[l[1]||(l[1]=o=>B.value=o),H],options:P.value,onFilter:Z,"use-input":"","emit-value":"","map-options":"",dark:a.dark,color:a.dark?"white":"",error:a.invalid,"hide-dropdown-icon":"","input-debounce":"350",autocomplete:"postcode-filter",outlined:"",disable:a.disabled,"use-chips":"",ref:"qSelectPostcodeRegion",borderless:a.borderless,dense:a.dense,class:"q-pb-none",filled:a.filled,loading:m.value,multiple:a.multiple,placeholder:a.placeholder,"option-label":"label"},{prepend:b(()=>[v(C,{name:"place",color:"info"})]),loading:b(()=>[m.value?(d(),V(ee,{key:0})):f("",!0)]),_:1},8,["modelValue","options","dark","color","error","disable","borderless","dense","filled","loading","multiple","placeholder"])])]),_(q).length?(d(),g("div",ce,[re,I(),(d(!0),g(O,null,N(_(q),(o,p)=>(d(),V(w,{outline:"",size:"sm",key:p,label:`${o.locality} (${o.state})`,onClick:i=>j(o),class:"cursor-pointer q-mr-sm q-mb-sm",color:"grey"},null,8,["label","onClick"]))),128)),v(w,{onClick:l[2]||(l[2]=o=>E()),color:"primary",label:"Add all",icon:"add_circle",size:"sm",class:"q-mb-sm"})])):f("",!0),a.modelValue&&a.modelValue.length?(d(),V(w,{key:1,onClick:l[3]||(l[3]=o=>k.value=!k.value),label:"Show map",color:"primary",flat:"",icon:"public"})):f("",!0),k.value?(d(),g("div",me,[r("p",ge,[v(C,{name:"info"}),I(" Click a suburb on the map to add it to the selected suburbs.")]),v(c,{center:y.value,zoom:L.value,"map-type-id":"terrain",style:{width:"100%",height:"450px"},ref_key:"mapRefMarker",ref:z,onClick:A},{default:b(()=>[(d(!0),g(O,null,N(n.value,(o,p)=>(d(),V(s,{position:o.latLng,key:p,clickable:!0,draggable:!1,onClick:l[4]||(l[4]=i=>y.value=a.latLng)},null,8,["position"]))),128))]),_:1},8,["center","zoom"])])):f("",!0)]),r("div",ve,[!a.modelValue||!a.modelValue.length?(d(),g("div",pe,"No suburbs selected.")):f("",!0),a.modelValue&&a.modelValue.length?(d(),g("div",fe,[r("div",ye,"Selected ("+le(a.modelValue.length)+"):",1),r("div",null,[(d(!0),g(O,null,N(_(ae)(a.modelValue,"locality","asc"),o=>(d(),V(te,{label:`${o.locality} (${o.state} ${o.postcode})`,key:o.id,class:"q-mr-sm q-mb-sm",color:"grey-2","text-color":"black"},{default:b(()=>[v(w,{icon:"close",onClick:p=>U(o),size:"sm",round:"",dense:"",flat:"",class:"q-ml-xs"},null,8,["onClick"])]),_:2},1032,["label"]))),128))])])):f("",!0)])])])):f("",!0)}}});export{$e as _};
