import{_ as x}from"./GlobalNotifications.42557f9a.js";import{Q as k}from"./QSelect.0342b451.js";import{A as j,i as B,r as p,B as E,o as w,m as v,K as A,L as f,l as n,q as r,ai as _,N as M,U as c,n as Q,R as T,y,M as D,S as $,ae as R,Q as H}from"./index.7da93179.js";import{Q as I}from"./QEditor.029e164b.js";import{u as K,r as s}from"./index.esm.0811bb15.js";import{u as L}from"./use-quasar.41dfdbfa.js";import{a as b}from"./axios.07c7c7d9.js";import{u as V}from"./debug.9f3fb657.js";import{d as O}from"./help.4068c5a1.js";import"./QToolbarTitle.8a26e038.js";import"./QTable.01150601.js";import"./QList.709f4980.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./ClosePopup.42f5b568.js";import"./QBadge.d2d220ed.js";import"./QItem.642560fa.js";import"./rtl.ba9e3bff.js";import"./QMenu.00781621.js";import"./format.3e32b8d9.js";import"./QBtnGroup.17d5a1bd.js";const z=r("div",{class:"text-h6 q-mb-md"},"Send Notification",-1),F={key:0,class:"bg-positive text-white q-pa-md q-mt-md"},G=j({__name:"SendNotificationUser",props:{cc:null,notificationUser:null},setup(a){const l=a,m=L(),S=B("bus"),u=p(),U=p(),g=p(),h={user_id:l.notificationUser.id,notification_template_id:null,notifiable_id:l.notificationUser.id,notifiable_type:"User",html:"",subject:null,cc:l.cc||[]},t=E(h),d=K({user_id:{required:s},notifiable_id:{required:s},notifiable_type:{required:s},subject:{required:s},html:{required:s}},t),C=()=>{u.value=null,Object.assign(t,h)},N=()=>{if(!t.notification_template_id){t.subject=null,t.html="";return}b.get(`/notificationtemplate/${t.notification_template_id}`).then(i=>{i.data.content?(t.html=i.data.content,t.subject=i.data.subject):U.value=""})},q=()=>{m.loading.show({message:"Queuing emails for sending..."}),b.post("/notification/sendsingle",t).then(i=>{O("positive","Emails queued for sending"),m.loading.hide(),u.value=i.data,S.emit("getNotifications"),t.subject=null,t.html=""}).catch(i=>{V(i),m.loading.hide()})};return w(()=>{b.get("/notificationtemplate/index").then(i=>{g.value=[{value:null,label:"Select a template"}].concat(i.data.map(e=>({value:e.id,label:e.name})))}).catch(i=>{V(i)})}),(i,e)=>(v(),A(H,null,{default:f(()=>[n(D,null,{default:f(()=>[z,r("p",null,"Send a notification to "+_(a.notificationUser.email)+".",1),n(k,{modelValue:t.notification_template_id,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.notification_template_id=o),e[1]||(e[1]=o=>N())],options:g.value,"emit-value":"","map-options":"",label:"Template",outlined:"",class:"q-mb-md"},null,8,["modelValue","options"]),n(M,{modelValue:t.subject,"onUpdate:modelValue":e[2]||(e[2]=o=>t.subject=o),label:"Subject",error:c(d).subject.$invalid,onBlur:e[3]||(e[3]=o=>c(d).subject.$touch())},null,8,["modelValue","error"]),n(I,{modelValue:t.html,"onUpdate:modelValue":e[4]||(e[4]=o=>t.html=o),label:"Content",error:c(d).html.$invalid},null,8,["modelValue","error"]),u.value?(v(),Q("div",F,[T(" Email sent to "),r("strong",null,_(u.value.email),1)])):y("",!0)]),_:1}),n(R,{align:"right"},{default:f(()=>[n($,{onClick:e[5]||(e[5]=o=>C()),color:"secondary",label:"Reset"}),n($,{onClick:e[6]||(e[6]=o=>q()),disable:c(d).$invalid,label:"Send",color:"primary",icon:"send"},null,8,["disable"])]),_:1})]),_:1}))}}),J={key:0},P=r("div",{class:"text-h5"},"Email Activities",-1),ht=j({__name:"ContractorNotification",props:{model:null},setup(a){return(l,m)=>a.model.id?(v(),Q("div",J,[P,r("p",null,"Send an Email or view the history for this "+_(l.$t("contractor.name"))+".",1),n(G,{"notification-user":a.model,class:"q-mb-lg"},null,8,["notification-user"]),n(x,{notifiable_id:a.model.id,notifiable_type:"User"},null,8,["notifiable_id"])])):y("",!0)}});export{ht as default};
