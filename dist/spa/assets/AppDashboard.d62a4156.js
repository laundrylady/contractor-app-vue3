import{V as ne,A as U,r as p,B as P,o as J,J as M,m as r,n as g,q as s,l as e,L as o,O as H,S as V,P as re,N as ee,y as v,K as f,F as Y,b1 as W,i as te,E as oe,Q as C,R as w,ai as d,U as R,G as X,M as q,ae as de,aj as ie}from"./index.7da93179.js";import{Q as ue,a as ce}from"./QBreadcrumbs.96094532.js";import{Q as F,a as $}from"./QItem.642560fa.js";import{Q as z}from"./QList.709f4980.js";import{u as me,a as pe,b as _e,Q as ve}from"./QTabs.33e82f7a.js";import{Q as E}from"./QCircularProgress.a2ed8130.js";import{Q as fe}from"./QPage.e25f8b02.js";import{a as O,h as ge}from"./axios.07c7c7d9.js";import{u as he}from"./use-quasar.41dfdbfa.js";import{Q as be}from"./QBtnGroup.17d5a1bd.js";import{u as T}from"./debug.9f3fb657.js";import{N as se}from"./NoRecords.0d3bf894.js";import{_ as ke}from"./PostcodeRegionGroupField.98fd4636.js";import{_ as ye}from"./OrderListFormat.c0b373f2.js";import{_ as Z}from"./UserAvatar.41db8b9e.js";import{Q as xe,a as we}from"./QToolbarTitle.8a26e038.js";import{Q as $e}from"./QSpace.2d911a61.js";import{C as j}from"./ClosePopup.42f5b568.js";import{_ as Me,m as ae,n as A,d as Ce,l as qe}from"./help.4068c5a1.js";import{_ as K}from"./PostcodeRegionDisplay.128d2d33.js";import"./QResizeObserver.66f1c4a6.js";import"./rtl.ba9e3bff.js";import"./format.3e32b8d9.js";import"./QSelect.0342b451.js";import"./QMenu.00781621.js";import"./geolocation.17ee4622.js";import"./StatusTag.c958dd1f.js";import"./QBadge.d2d220ed.js";var L=ne({name:"QTab",props:me,emits:pe,setup(B,{slots:m,emit:_}){const{renderTab:t}=_e(B,m,_);return()=>t("div")}});const Qe={class:"q-pb-sm"},De={key:0,class:"q-pa-md text-center"},Ye={style:{height:"400px"}},Re=U({__name:"ContractorsMap",setup(B){const m=p(!1),_=p(),t=p(),i=p(),k=P({lat:-26.6851157,lng:153.1074659}),b=p(),c=p(null),u=P({content:"",pixelOffset:{width:0,height:0}}),y=()=>{i.value=[],_.value.forEach(a=>{a.lat&&a.lng&&i.value.push({position:{lat:parseFloat(a.lat),lng:parseFloat(a.lng)},model:a,infoText:a.name})}),i.value.length===1&&Object.assign(k,i.value[0].position),m.value=!1},I=a=>`<div class="text-h5">${a.model.fullname}</div><p>${a.model.address2} ${a.model.postcoderegionsuburb.locality} ${a.model.postcoderegionsuburb.state} ${a.model.postcoderegionsuburb.postcode}</p>`,N=(a,n)=>{b.value=a.position,u.content=I(a),c.value=n},Q=()=>{m.value=!0,O.post("/user/contractor/map",{keyword:t.value}).then(a=>{_.value=a.data,y()}).catch(a=>{T(a),m.value=!1})};return J(()=>{Q()}),(a,n)=>{const x=M("GMapInfoWindow"),G=M("GMapMarker"),l=M("GMapCluster"),S=M("GMapMap");return r(),g("div",null,[s("div",Qe,[e(ee,{modelValue:t.value,"onUpdate:modelValue":n[1]||(n[1]=h=>t.value=h),placeholder:"Keyword search",outlined:"",onKeydown:n[2]||(n[2]=re(h=>Q(),["enter"])),dense:""},{prepend:o(()=>[e(H,{name:"search"})]),append:o(()=>[e(be,null,{default:o(()=>[e(V,{onClick:n[0]||(n[0]=h=>[t.value=null,Q()]),label:"Reset",size:"sm"})]),_:1})]),_:1},8,["modelValue"])]),(!_.value||!_.value.length)&&!m.value?(r(),g("div",De,[e(se)])):v("",!0),s("div",Ye,[i.value&&i.value.length?(r(),f(S,{key:0,center:k,zoom:4,"map-type-id":"terrain",style:{width:"100%",height:"650px"},ref:"mapRef"},{default:o(()=>[e(l,null,{default:o(()=>[(r(!0),g(Y,null,W(i.value,(h,D)=>(r(),f(G,{position:h.position,clickable:!0,draggable:!1,onClick:le=>N(h,D),key:D},{default:o(()=>[e(x,{options:u,position:b.value,opened:c.value===D},null,8,["options","position","opened"])]),_:2},1032,["position","onClick"]))),128))]),_:1})]),_:1},8,["center"])):v("",!0)])])}}}),Ve={class:"q-pb-sm row q-col-gutter-md"},Ge={class:"col-xs-12 col-sm-4"},We={class:"col-xs-12 col-sm-6"},Pe={class:"col-xs-12 col-sm-2"},Oe={key:0,class:"q-pa-md text-center"},Te={style:{height:"400px"}},Be=U({__name:"CustomersMap",setup(B){const m=p(!1),_=p(),t=P({keyword:null,postcode_region_group_id:null}),i=p(),k=P({lat:-26.6851157,lng:153.1074659}),b=p(),c=p(),u=P({content:"",pixelOffset:{width:0,height:0}}),y=()=>{i.value=[],_.value.forEach(a=>{a.lat&&a.lng&&i.value.push({position:{lat:parseFloat(a.lat),lng:parseFloat(a.lng)},model:a,infoText:a.name})}),i.value.length===1&&Object.assign(k,i.value[0].position),m.value=!1},I=a=>`<div class="text-h5">${a.model.name}</div><p>${a.model.address2} ${a.model.suburbpostcoderegion.locality} ${a.model.suburbpostcoderegion.state} ${a.model.suburbpostcoderegion.postcode}</p>`,N=(a,n)=>{b.value=a.position,u.content=I(a),c.value=n},Q=()=>{m.value=!0,O.post("/team/map",{keyword:t.keyword,postcode_region_group_id:t.postcode_region_group_id}).then(a=>{_.value=a.data,y()}).catch(a=>{T(a),m.value=!1})};return(a,n)=>{const x=M("GMapInfoWindow"),G=M("GMapMarker"),l=M("GMapCluster"),S=M("GMapMap");return r(),g("div",null,[s("div",Ve,[s("div",Ge,[e(ee,{modelValue:t.keyword,"onUpdate:modelValue":n[0]||(n[0]=h=>t.keyword=h),placeholder:"Keyword search",outlined:"",dense:"",clearable:""},{prepend:o(()=>[e(H,{name:"search"})]),_:1},8,["modelValue"])]),s("div",We,[e(ke,{modelValue:t.postcode_region_group_id,"onUpdate:modelValue":n[1]||(n[1]=h=>t.postcode_region_group_id=h),label:"Choose an area",outlined:!0,dense:!0,class:"q-mb-md"},null,8,["modelValue"])]),s("div",Pe,[e(V,{onClick:n[2]||(n[2]=h=>Q()),icon:"search",color:"primary",disable:m.value||!t.keyword&&!t.postcode_region_group_id},null,8,["disable"])])]),(!_.value||!_.value.length)&&!m.value?(r(),g("div",Oe,[e(se)])):v("",!0),s("div",Te,[i.value&&i.value.length?(r(),f(S,{key:0,center:k,zoom:4,"map-type-id":"terrain",style:{width:"100%",height:"650px"},ref:"mapRef"},{default:o(()=>[e(l,null,{default:o(()=>[(r(!0),g(Y,null,W(i.value,(h,D)=>(r(),f(G,{position:h.position,clickable:!0,draggable:!1,onClick:le=>N(h,D),key:D},{default:o(()=>[e(x,{options:u,position:b.value,opened:c.value===D},null,8,["options","position","opened"])]),_:2},1032,["position","onClick"]))),128))]),_:1})]),_:1},8,["center"])):v("",!0)])])}}}),Ie={class:"row q-col-gutter-md"},Ne={class:"col-xs-12 col-sm-6"},Se=s("div",{class:"text-bold q-mb-xs"},"Current Suburbs to pickup from:",-1),Fe={class:"col-xs-12 col-sm-6"},ze=s("div",{class:"text-bold q-mb-xs"},"New Suburbs to pickup from:",-1),Ae=s("div",{class:"text-bold q-mb-xs q-mt-md"},"Changes",-1),Ue=U({__name:"UserRosterApprove",setup(B){const m=p(!1),_=p(),t=P({id:null,day:null,start_time:null,end_time:null,active:!0,user_id:null,user:null,postcoderegions:[],capacity:{products:[]},approved:!1}),i=p(!1),k=te("bus"),b=c=>{i.value=!0,O.put(`/userroster/approve/${t.id}`,t).then(()=>{Ce("positive","Roster updated"),k.emit("getDashboardStats"),c&&(m.value=!1),i.value=!1}).catch(u=>{i.value=!1,T(u)})};return J(()=>{k.on("approveRoster",async c=>{O.get(`/userroster/${c}`).then(u=>{Object.assign(t,u.data),t.postcoderegions&&t.postcoderegions_old&&(_.value=Me.differenceBy(t.postcoderegions,t.postcoderegions_old,"id")),m.value=!0}).catch(u=>{T(u)})})}),oe(()=>{k.off("approveRoster")}),(c,u)=>(r(),f(ie,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=y=>m.value=y)},{default:o(()=>[t.day&&t.user&&t.start_time&&t.end_time?(r(),f(C,{key:0,class:"modal"},{default:o(()=>[t.user?(r(),f(xe,{key:0},{default:o(()=>[e(we,null,{default:o(()=>[w(d(t.user.fullname)+" - "+d(R(ae)(t.day))+"s ("+d(R(A)(t.start_time))+" - "+d(R(A)(t.end_time))+")",1)]),_:1}),e($e),X(e(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1})):v("",!0),e(q,null,{default:o(()=>[s("div",Ie,[s("div",Ne,[Se,t.postcoderegions_old?(r(),f(K,{key:0,postcoderegions:t.postcoderegions_old},null,8,["postcoderegions"])):v("",!0)]),s("div",Fe,[ze,e(K,{postcoderegions:t.postcoderegions},null,8,["postcoderegions"])])]),Ae,e(K,{postcoderegions:_.value},null,8,["postcoderegions"])]),_:1}),e(de,{align:"right"},{default:o(()=>[X(e(V,{label:"Cancel",flat:"",color:"secondary"},null,512),[[j]]),e(V,{disable:i.value,label:"Approve",color:"primary",onClick:u[0]||(u[0]=y=>b(!0)),loading:i.value},null,8,["disable","loading"])]),_:1})]),_:1})):v("",!0)]),_:1},8,["modelValue"]))}}),Ee=s("div",{class:"text-h4 q-mb-xs q-mt-md"}," Dashboard ",-1),Ke={class:"q-mt-lg"},Le=s("div",{class:"text-h6 q-mb-md"},"Roster Location Changes",-1),Je={class:"text-h7"},He={key:1,class:"row q-col-gutter-md"},Xe={class:"col-xs-12 col-sm-9"},Ze=s("div",{class:"text-h6 q-mb-md text-negative"},"Unassigned",-1),je={class:"row q-col-gutter-md"},et={class:"col-xs-12 col-sm-12"},tt=s("div",{class:"text-h6 q-mb-md"},"Recently Joined",-1),ot={key:0},st={class:"col-xs-12 col-sm-12"},at={class:"text-h6 q-mb-md"},lt={key:0},nt={class:"col-xs-12 col-sm-3"},rt={class:"text-bold q-mb-sm text-center",style:{"font-size":"15px"}},dt={key:0,class:"row q-col-gutter-md q-mb-lg"},it={key:0,class:"text-center col-xs-12"},ut={class:"text-h6"},ct={class:"row q-col-gutter-md"},mt={class:"col-xs-12 col-sm-4"},pt={class:"text-center"},_t={class:"text-h5 text-bold"},vt={class:"col-xs-12 col-sm-4"},ft={class:"text-center"},gt={class:"text-h5 text-bold"},ht={class:"col-xs-12 col-sm-4"},bt={class:"text-center"},kt={class:"text-h5 text-bold"},yt={class:"row q-col-gutter-md"},xt={class:"col-xs-12 col-sm-6"},wt={class:"text-center q-pt-md"},$t={class:"q-pa-sm text-caption"},Mt=s("div",{class:"q-mt-sm"},"Retained",-1),Ct={class:"col-xs-12 col-sm-6"},qt={class:"text-center q-pt-md"},Qt={class:"q-pa-sm text-caption"},Dt=s("div",{class:"q-mt-sm"},"Rebooked",-1),ao=U({__name:"AppDashboard",setup(B){const m=te("bus"),_=he(),t=p(),i=p(),k=p(!1),b=p("orders"),c=p(),u=p({start:null,end:null}),y=()=>{_.loading.show({message:"Fetching data..."}),O.post("/user/dashboardstats?allFeed=true").then(n=>{t.value=n.data,k.value=!0,I()}).catch(n=>{T(n),k.value=!0,_.loading.hide()})},I=()=>{O.post("/user/contractor/landing",u.value).then(n=>{i.value=n.data,_.loading.hide()}).catch(n=>{T(n),_.loading.hide()})},N=()=>{c.value=c.value.add(1,"weeks"),u.value={start:c.value.startOf("isoWeek").format("DD/MM/YYYY"),end:c.value.endOf("isoWeek").format("DD/MM/YYYY")},y()},Q=()=>{c.value=c.value.subtract(1,"weeks"),u.value={start:c.value.startOf("isoWeek").format("DD/MM/YYYY"),end:c.value.endOf("isoWeek").format("DD/MM/YYYY")},y()},a=n=>{m.emit("approveRoster",n)};return J(()=>{c.value=ge(),u.value={start:c.value.startOf("isoWeek").format("DD/MM/YYYY"),end:c.value.endOf("isoWeek").format("DD/MM/YYYY")},y(),m.on("getDashboardStats",()=>{y()})}),oe(()=>{m.off("getDashboardStats")}),(n,x)=>{const G=M("router-link");return r(),g(Y,null,[e(Ue),t.value?(r(),f(fe,{key:0,padding:""},{default:o(()=>[e(ce,{class:"q-mt-md"},{separator:o(()=>[e(H,{size:"1.5em",name:"chevron_right"})]),default:o(()=>[e(ue,{label:"Home",icon:"home",to:{name:"dashboard"}})]),_:1}),Ee,s("div",Ke,[t.value.rosterApprovals.length?(r(),f(C,{key:0,class:"bg-primary text-white q-mb-lg"},{default:o(()=>[e(q,null,{default:o(()=>[Le,e(z,{separator:""},{default:o(()=>[(r(!0),g(Y,null,W(t.value.rosterApprovals,l=>(r(),f(F,{key:l.id,clickable:"",onClick:S=>a(l.id)},{default:o(()=>[e($,null,{default:o(()=>[s("div",Je,d(l.user.fullname),1),s("div",null,d(R(ae)(l.day))+"s ("+d(R(A)(l.start_time))+" - "+d(R(A)(l.end_time))+")",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):v("",!0),e(ve,{modelValue:b.value,"onUpdate:modelValue":x[0]||(x[0]=l=>b.value=l),align:"left",class:"q-mb-md"},{default:o(()=>[e(L,{name:"orders",label:"Overview"}),e(L,{name:"contractors",label:`${n.$t("contractor.namePlural")} Map`},null,8,["label"]),e(L,{name:"customers",label:`${n.$t("team.namePlural")} Map`},null,8,["label"])]),_:1},8,["modelValue"]),b.value==="orders"?(r(),g("div",He,[s("div",Xe,[t.value.unAssigned.length?(r(),f(C,{key:0,class:"bg-seamless q-mb-lg"},{default:o(()=>[e(q,null,{default:o(()=>[Ze,e(ye,{orders:t.value.unAssigned},null,8,["orders"])]),_:1})]),_:1})):v("",!0),s("div",je,[s("div",et,[t.value.newContractors.length?(r(),f(C,{key:0,class:"bg-seamless q-mb-lg"},{default:o(()=>[e(q,null,{default:o(()=>[tt,e(z,{class:"bg-white",separator:""},{default:o(()=>[(r(!0),g(Y,null,W(t.value.newContractors,l=>(r(),f(F,{key:l.id},{default:o(()=>[e($,{avatar:""},{default:o(()=>[e(Z,{user:l},null,8,["user"])]),_:2},1024),e($,null,{default:o(()=>[s("div",null,[e(G,{to:{name:"contractor-dashboard",params:{id:l.id}},class:"link text-h6"},{default:o(()=>[w(d(l.fullname),1)]),_:2},1032,["to"]),l.postcoderegionsuburb?(r(),g("div",ot,d(l.postcoderegionsuburb.locality)+" "+d(l.postcoderegionsuburb.state),1)):v("",!0)])]),_:2},1024),e($,{side:""},{default:o(()=>[w(d(l.contractor_start_date),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):v("",!0)]),s("div",st,[t.value.newCustomers.length?(r(),f(C,{key:0,class:"bg-seamless q-mb-lg"},{default:o(()=>[e(q,null,{default:o(()=>[s("div",at,"New "+d(n.$t("team.namePlural")),1),e(z,{class:"bg-white",separator:""},{default:o(()=>[(r(!0),g(Y,null,W(t.value.newCustomers,l=>(r(),f(F,{key:l.id},{default:o(()=>[e($,{avatar:""},{default:o(()=>[e(Z,{user:l},null,8,["user"])]),_:2},1024),e($,null,{default:o(()=>[s("div",null,[e(G,{to:{name:"team-dashboard",params:{id:l.id}},class:"link text-h6"},{default:o(()=>[w(d(l.name),1)]),_:2},1032,["to"]),l.suburbpostcoderegion?(r(),g("div",lt,d(l.suburbpostcoderegion.locality)+" "+d(l.suburbpostcoderegion.state),1)):v("",!0)])]),_:2},1024),e($,{side:""},{default:o(()=>[w(d(R(qe)(l.created_at)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):v("",!0)])])]),s("div",nt,[s("div",rt,[e(V,{onClick:x[1]||(x[1]=l=>Q()),flat:"",icon:"chevron_left",class:"q-mr-sm",round:""}),w(d(u.value.start)+" -> "+d(u.value.end),1),e(V,{onClick:x[2]||(x[2]=l=>N()),flat:"",icon:"chevron_right",class:"q-ml-sm",round:""})]),i.value?(r(),g("div",dt,[i.value.length?v("",!0):(r(),g("div",it,"No records found for this date range.")),(r(!0),g(Y,null,W(i.value,l=>(r(),g("div",{class:"col-xs-12",key:l.name},[e(C,null,{default:o(()=>[e(z,{class:"bg-white"},{default:o(()=>[e(F,null,{default:o(()=>[e($,{side:""},{default:o(()=>[e(E,{value:l.per,size:"40px",color:"primary","track-color":"grey-5",thickness:.3},null,8,["value","thickness"])]),_:2},1024),e($,null,{default:o(()=>[s("div",ut,d(l.name)+" Bookings",1),s("div",null,d(l.oc)+"/"+d(l.cc)+" - "+d(l.per)+"% ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))])):v("",!0),e(C,{class:"bg-secondary text-white"},{default:o(()=>[e(q,{class:"text-h6"},{default:o(()=>[w("Statistics")]),_:1}),e(q,null,{default:o(()=>[s("div",ct,[s("div",mt,[s("div",pt,[s("div",_t,d(t.value.totalOrdersCount[0].count),1),w(" "+d(n.$t("order.namePlural")),1)])]),s("div",vt,[s("div",ft,[s("div",gt,d(t.value.totalContractors[0].count),1),w(" "+d(n.$t("contractor.namePlural")),1)])]),s("div",ht,[s("div",bt,[s("div",kt,d(t.value.totalCustomers[0].count),1),w(" "+d(n.$t("team.namePlural")),1)])])])]),_:1})]),_:1}),e(C,{class:"bg-seamless q-mb-md q-mt-sm"},{default:o(()=>[e(q,null,{default:o(()=>[s("div",yt,[s("div",xt,[s("div",wt,[e(E,{value:parseFloat(t.value.retainedRebooked.retainedPercentage),color:"secondary",size:"64px","track-color":"grey-4","show-value":"",title:t.value.retainedRebooked.retained},{default:o(()=>[s("div",$t,d(t.value.retainedRebooked.retainedPercentage)+"%",1)]),_:1},8,["value","title"]),Mt])]),s("div",Ct,[s("div",qt,[e(E,{value:parseFloat(t.value.retainedRebooked.rebookedPercentage),color:"secondary",size:"64px","track-color":"grey-4","show-value":"",title:t.value.retainedRebooked.rebooked},{default:o(()=>[s("div",Qt,d(t.value.retainedRebooked.rebookedPercentage)+"%",1)]),_:1},8,["value","title"]),Dt])])])]),_:1})]),_:1})])])):v("",!0),b.value==="contractors"?(r(),f(Re,{key:2})):v("",!0),b.value==="customers"?(r(),f(Be,{key:3})):v("",!0)])]),_:1})):v("",!0)],64)}}});export{ao as default};
