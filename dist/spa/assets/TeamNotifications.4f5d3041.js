import{Q as w,_ as A}from"./QEditor.13b04ec6.js";import{Q as U}from"./QSelect.5b5bbc87.js";import{A as q,i as M,r as f,B as O,o as D,m as o,K as F,L as _,l as a,N as J,U as b,n,R as j,q as d,F as N,b7 as Q,y as g,M as L,S,ae as R,Q as H,b8 as u}from"./index.fbd59a76.js";import{u as I,r as v}from"./index.esm.b35330f2.js";import{u as K}from"./use-quasar.1140b8ec.js";import{a as h}from"./axios.b71dd2ad.js";import{u as k}from"./debug.805a8aef.js";import{b as z}from"./help.24013814.js";import"./QToolbarTitle.a19fbe89.js";import"./QTable.1191bda5.js";import"./QList.eaa15994.js";import"./QMarkupTable.e4b2956c.js";import"./QLinearProgress.457e2dab.js";import"./ClosePopup.117d0adb.js";import"./QBadge.3656646d.js";import"./QBtnGroup.bdc458fc.js";import"./format.c926bd4b.js";import"./QItemSection.e2ef8c04.js";import"./rtl.af167dee.js";const G=d("div",{class:"text-h6 q-mb-md"},"Send Notification",-1),P={key:0,class:"q-pa-md"},W={key:1,class:"bg-positive text-white q-pa-md q-mt-md"},X=q({__name:"SendNotificationTeam",props:{notifiable_id:null,team:null},setup(s){const r=s,c=K(),x=M("bus"),m=f(),C=f(),$=f(),y={notification_template_id:null,notifiable_id:r.notifiable_id,notifiable_type:"Team",html:"",subject:null},i=O(y),V=f(),p=I({notifiable_id:{required:v},notifiable_type:{required:v},subject:{required:v},html:{required:v}},i),B=()=>{m.value=null,Object.assign(i,JSON.parse(JSON.stringify(y)))},E=()=>{if(!i.notification_template_id){i.subject=null,i.html="";return}h.get(`/notificationtemplate/${i.notification_template_id}`).then(l=>{l.data.content?(i.html=l.data.content,i.subject=l.data.subject):C.value=""})},T=()=>{c.loading.show({message:"Queuing emails for sending..."}),h.post("/notification/sendteam",i).then(l=>{z("positive","Emails queued for sending"),c.loading.hide(),m.value=l.data,x.emit("getNotifications"),i.subject=null,i.html=""}).catch(l=>{k(l),c.loading.hide()})};return D(()=>{const l=[];r.team.users&&(r.team.users.forEach(e=>{e.user.email_notifications&&l.push(e.user)}),V.value=l),h.get("/notificationtemplate/index").then(e=>{$.value=[{value:null,label:"Select a template"}].concat(e.data.map(t=>({value:t.id,label:t.name})))}).catch(e=>{k(e)})}),(l,e)=>(o(),F(H,null,{default:_(()=>[a(L,null,{default:_(()=>[G,a(U,{modelValue:i.notification_template_id,"onUpdate:modelValue":[e[0]||(e[0]=t=>i.notification_template_id=t),e[1]||(e[1]=t=>E())],options:$.value,"emit-value":"","map-options":"",label:"Template",outlined:"",class:"q-mb-md"},null,8,["modelValue","options"]),a(J,{modelValue:i.subject,"onUpdate:modelValue":e[2]||(e[2]=t=>i.subject=t),label:"Subject",error:b(p).subject.$invalid,onBlur:e[3]||(e[3]=t=>b(p).subject.$touch())},null,8,["modelValue","error"]),a(w,{modelValue:i.html,"onUpdate:modelValue":e[4]||(e[4]=t=>i.html=t),label:"Content",error:b(p).html.$invalid},null,8,["modelValue","error"]),!m.value||!m.value.length?(o(),n("div",P,[j(" An email will be sent to the following members: "),d("ul",null,[(o(!0),n(N,null,Q(V.value,t=>(o(),n("li",{key:t.id},u(t.fullname)+" ("+u(t.email)+") ",1))),128))])])):g("",!0),m.value?(o(),n("div",W,[j(" Email sent to: "),(o(!0),n(N,null,Q(m.value,t=>(o(),n("div",{key:t.id},[d("strong",null,u(t.user.fullname)+" ("+u(t.user.email)+")",1)]))),128))])):g("",!0)]),_:1}),a(R,{align:"right"},{default:_(()=>[a(S,{onClick:e[5]||(e[5]=t=>B()),color:"secondary",label:"Reset"}),a(S,{onClick:e[6]||(e[6]=t=>T()),disable:b(p).$invalid,label:"Send",color:"primary"},null,8,["disable"])]),_:1})]),_:1}))}}),Y={key:0},Z=d("div",{class:"text-h5"},"Email Activities",-1),$e=q({__name:"TeamNotifications",props:{model:null},setup(s){return(r,c)=>s.model.id?(o(),n("div",Y,[Z,d("p",null,"Send an Email or view the history for this "+u(r.$t("team.name"))+".",1),a(X,{team:s.model,notifiable_id:s.model.id,class:"q-mb-lg"},null,8,["team","notifiable_id"]),a(A,{notifiable_id:s.model.id,notifiable_type:"Team"},null,8,["notifiable_id"])])):g("",!0)}});export{$e as default};
