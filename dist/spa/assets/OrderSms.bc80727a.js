import{Q}from"./QSelect.0342b451.js";import{A as C,i as q,r as c,B,o as A,m as l,K as J,L as f,l as r,N as L,U as y,n,R as x,q as u,F as V,b1 as $,y as v,M as T,S as U,ae as D,Q as E,ai as d}from"./index.7da93179.js";import{u as F,r as N}from"./index.esm.0811bb15.js";import{a as k}from"./axios.07c7c7d9.js";import{u as w}from"./debug.9f3fb657.js";import{d as j}from"./help.4068c5a1.js";import{_ as I}from"./SmsLogComponent.07bbce11.js";import"./QItem.642560fa.js";import"./rtl.ba9e3bff.js";import"./QMenu.00781621.js";import"./format.3e32b8d9.js";import"./QTable.01150601.js";import"./QList.709f4980.js";import"./QMarkupTable.f781861b.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";const K=u("div",{class:"text-h6 q-mb-md"},"Send SMS",-1),R={key:0,class:"q-pa-md"},z={key:1,class:"q-pa-md bg-positive text-white"},G=C({__name:"SendSmsOrder",props:{order:null},setup(m){const s=m,g=q("bus"),i=c([]),p=c(!1),_=c(),S={content:null,template:null,number:null,team_id:s.order.team_id,order_id:s.order.id},a=B(JSON.parse(JSON.stringify(S))),b=F({content:{required:N},team_id:{required:N}},a),h=c(),M=()=>{a.content=a.template},O=()=>{p.value=!0,k.post("/sms/sendorder",a).then(o=>{j("positive",`SMS sent to ${s.order.team.name}`),p.value=!1,i.value=o.data,g.emit("getSmsLog",{}),Object.assign(a,JSON.parse(JSON.stringify(S)))}).catch(o=>{w(o),p.value=!1})};return A(()=>{Object.assign(a,{content:null,template:null,number:null,team_id:s.order.team_id});const o=[];s.order&&s.order.team.users&&(s.order.team.users.forEach(e=>{e.mobile&&e.sms_notifications&&o.push(e)}),h.value=o),k.get("/smstemplate/index").then(e=>{_.value=e.data.map(t=>({value:t.content,label:t.name}))}).catch(e=>{w(e)})}),(o,e)=>(l(),J(E,null,{default:f(()=>[r(T,null,{default:f(()=>[K,r(Q,{modelValue:a.template,"onUpdate:modelValue":[e[0]||(e[0]=t=>a.template=t),e[1]||(e[1]=t=>M())],options:_.value,label:"Choose a Template","map-options":"","emit-value":"",class:"q-mb-md"},null,8,["modelValue","options"]),r(L,{modelValue:a.content,"onUpdate:modelValue":e[2]||(e[2]=t=>a.content=t),type:"textarea",maxlength:"160",label:"Message to send",error:y(b).content.$error,autogrow:""},null,8,["modelValue","error"]),!i.value||!i.value.length?(l(),n("div",R,[x(" A message will be sent to the following members: "),u("ul",null,[(l(!0),n(V,null,$(h.value,t=>(l(),n("li",{key:t.id},d(t.fullname)+" ("+d(t.mobile)+") ",1))),128))])])):v("",!0),i.value&&i.value.length?(l(),n("div",z,[x(" A message was sent to the following members: "),u("ul",null,[(l(!0),n(V,null,$(i.value,t=>(l(),n("li",{key:t.id},d(t.user.fullname)+" ("+d(t.user.mobile)+") ",1))),128))])])):v("",!0)]),_:1}),r(D,{align:"right"},{default:f(()=>[r(U,{color:"primary",disabled:y(b).$invalid,loading:p.value,onClick:e[3]||(e[3]=t=>O()),label:"Send"},null,8,["disabled","loading"])]),_:1})]),_:1}))}}),H={key:0},P=u("div",{class:"text-h6"},"SMS Activities",-1),ce=C({__name:"OrderSms",props:{model:null},setup(m){return(s,g)=>m.model.id?(l(),n("div",H,[P,u("p",null,"Send an SMS or view the history for this "+d(s.$t("team.name"))+".",1),r(G,{order:m.model,class:"q-mb-lg"},null,8,["order"]),r(I,{order_id:m.model.id},null,8,["order_id"])])):v("",!0)}});export{ce as default};
