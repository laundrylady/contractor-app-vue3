import{A as z,i as se,g as ne,B as F,r as Q,o as oe,m as u,n as k,l,L as s,M as I,q as n,b8 as d,y as c,S as T,K as g,R as p,U as b,Q as O,F as ie,b7 as re,N as S,af as ue,G as q}from"./index.fbd59a76.js";import{Q as L}from"./QSelect.5b5bbc87.js";import{a as de,Q as D}from"./QTable.1191bda5.js";import{Q as w,a as V}from"./QItemSection.e2ef8c04.js";import{Q as B}from"./QList.eaa15994.js";import{Q as J}from"./format.c926bd4b.js";import{Q as me}from"./QMarkupTable.e4b2956c.js";import{Q as ce}from"./QSpace.8da48267.js";import{C as j}from"./ClosePopup.117d0adb.js";import{u as ve,r as N,e as fe}from"./index.esm.b35330f2.js";import{a as f}from"./axios.b71dd2ad.js";import{N as _e}from"./NoRecords.3250f2f6.js";import{u as _}from"./debug.805a8aef.js";import{b as h,c as A,l as pe,A as be}from"./help.24013814.js";import"./rtl.af167dee.js";import"./QLinearProgress.457e2dab.js";const he={class:"text-h6"},ge={key:0,class:"bg-accent text-white q-pa-sm q-mr-sm"},ke={class:"text-h6"},we=n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"First name"),n("th",{class:"text-left"},"Last name"),n("th",{class:"text-left"},"Email"),n("th",{class:"text-left"},"Access"),n("th",{class:"text-left"},"Sent"),n("th",{class:"text-left"},"Status"),n("th",{class:"text-center"},"Actions")])],-1),Ve={key:0},$e=n("br",null,null,-1),ye={class:"text-center"},Ce=n("div",{class:"text-h6"},"New Invitation",-1),Ue={class:"row q-col-gutter-sm items-center"},Ie={class:"col-xs-12 col-md-3"},Se={class:"col-xs-6 col-md-3"},xe={class:"col-xs-6 col-md-3"},Qe={class:"col-xs-6 col-md-3"},Te={class:"flex"},Ne={key:0,class:"text-warning"},Ae=z({__name:"TeamUserManagement",props:{team:null},setup(v){const m=v,$=se("bus"),K=ne(()=>{let a=0;return m.team.users&&m.team.users.forEach(t=>{["administrator","owner"].indexOf(t.role)!==-1&&(a+=1)}),a}),G=F({keyword:null}),o=Q(!1),x=Q(!1),y=Q([]),P={email:null,first_name:null,last_name:null,role:"user",team_id:m.team.id,bypass:!0},r=F(JSON.parse(JSON.stringify(P))),C=ve({email:{required:N,email:fe},first_name:{required:N},last_name:{required:N},role:{required:N}},r),H=Q(),M=[{value:"owner",label:"Owner"},{value:"administrator",label:"Administrator"},{value:"user",label:"User"},{value:"ndis",label:"NDIS Plan Manager"}],W=[{name:"user.first_name",sortable:!1,label:"First name",field:"user.first_name",format:(a,t)=>t.user.first_name,align:"left"},{name:"user.last_name",sortable:!1,label:"Last name",field:"user.last_name",format:(a,t)=>t.user.last_name,align:"left"},{name:"user.email",sortable:!1,label:"Email",field:"user.email",format:(a,t)=>t.user.email,align:"left"},{name:"role",sortable:!1,label:"Access",field:"role",align:"left"},{name:"actions",sortable:!1,label:"Actions",field:"actions"}],X=a=>{o.value=!0,f.put(`/teamuser/update/${a.id}`,a).then(()=>{h("positive","Saved"),o.value=!1}).catch(t=>{_(t)})},Y=a=>{A("This will remove the user and all associated access").onOk(()=>{o.value=!0,f.delete(`/teamuser/remove/${a.team_id}/${a.id}`).then(()=>{h("negative","User removed"),$.emit("getTeam"),o.value=!1}).catch(t=>{o.value=!1,_(t)})})},Z=a=>{A("This will reset the MFA for this user.").onOk(()=>{o.value=!0,f.get(`/teamuser/resetmfa/${a.team_id}/${a.id}`).then(()=>{h("negative","User MFA reset"),$.emit("getTeam"),o.value=!1}).catch(t=>{o.value=!1,_(t)})})},R=(a,t)=>{let e="This will disable access";t===1&&(e="This will re-enable access"),A(e).onOk(()=>{o.value=!0,f.put(`/teamuser/toggleaccess/${a.team_id}/${a.id}`,{active:t}).then(()=>{h("positive","Saved"),$.emit("getTeam"),o.value=!1}).catch(i=>{o.value=!1,_(i)})})},U=()=>{o.value=!0,f.get(`/teaminvite/team/${m.team.id}`).then(a=>{y.value=a.data,o.value=!1}).catch(a=>{_(a),o.value=!1})},ee=()=>{x.value=!0,r.team_id=m.team.id,f.post("/teaminvite/inviteuser",r).then(()=>{h("positive","Invitation sent"),x.value=!1,U(),$.emit("getTeam"),Object.assign(r,JSON.parse(JSON.stringify(P)))}).catch(a=>{x.value=!1,_(a)})},E=a=>{f.put(`/teaminvite/${a.id}`,a).then(()=>{U(),h("positive","Saved")}).catch(t=>{_(t)})},te=a=>{f.get(`/teaminvite/resend/${a}`).then(()=>{h("positive","Invitation resent"),U()}).catch(t=>{_(t)})},le=a=>{A("This will revoke the invitation.").onOk(()=>{o.value=!0,f.delete(`/teaminvite/${a}`).then(()=>{h("negative","Invitation revoked"),U()}).catch(t=>{o.value=!1,_(t)})})},ae=()=>{r.email=m.team.email,r.first_name=m.team.first_name,r.last_name=m.team.last_name,r.role="owner"};return oe(()=>{U()}),(a,t)=>(u(),k("div",null,[l(O,null,{default:s(()=>[l(I,null,{default:s(()=>[n("div",he,d(a.$t("team.userPlural"))+" ("+d(v.team.users&&v.team.users.length)+")",1),n("p",null,"To invite new "+d(a.$t("team.userPlural").toLowerCase())+', use the "New Invitation" section below. ',1)]),_:1}),l(de,{rows:v.team.users,columns:W,"row-key":"id",filter:G.keyword,loading:o.value,class:"no-shadow"},{"body-cell-role":s(e=>[l(D,{props:e},{default:s(()=>[l(L,{modelValue:e.row.role,"onUpdate:modelValue":[i=>e.row.role=i,i=>X(e.row)],options:M,"map-options":"","emit-value":"",placeholder:"Role",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-actions":s(e=>[l(D,{props:e},{default:s(()=>[e.row.active?c("",!0):(u(),k("span",ge,"REVOKED ACCESS")),l(T,{icon:"more_vert",flat:""},{default:s(()=>[l(J,null,{default:s(()=>[l(B,null,{default:s(()=>[e.row.active?(u(),g(V,{key:0,onClick:i=>R(e.row,0),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p("Revoke Access")]),_:1})]),_:2},1032,["onClick"])):c("",!0),e.row.active?c("",!0):(u(),g(V,{key:1,onClick:i=>R(e.row,1),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p("Enable Access")]),_:1})]),_:2},1032,["onClick"])),l(V,{onClick:i=>Z(e.row),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p("Reset MFA")]),_:1})]),_:2},1032,["onClick"]),v.team.users&&v.team.users.length>1&&(e.row.role!=="administrator"||b(K)>1)?(u(),g(V,{key:2,onClick:i=>Y(e.row),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p("Remove User")]),_:1})]),_:2},1032,["onClick"])):c("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading"])]),_:1}),l(O,{class:"q-mt-md q-mb-md"},{default:s(()=>[l(I,null,{default:s(()=>[n("div",ke,"Pending Invitations ("+d(y.value.length)+")",1),n("p",null,d(a.$t("team.userPlural"))+" that have been sent an invitation email but have not responded are listed below. ",1)]),_:1}),y.value.length?c("",!0):(u(),g(I,{key:0,class:"text-center"},{default:s(()=>[l(_e)]),_:1})),y.value.length?(u(),g(me,{key:1},{default:s(()=>[we,n("tbody",null,[(u(!0),k(ie,null,re(y.value,e=>(u(),k("tr",{key:e.id},[n("td",null,[l(S,{modelValue:e.first_name,"onUpdate:modelValue":i=>e.first_name=i,borderless:"",onInput:i=>E(e),debounce:"500"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),n("td",null,[l(S,{modelValue:e.last_name,"onUpdate:modelValue":i=>e.last_name=i,borderless:"",onInput:i=>E(e),debounce:"500"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),n("td",null,d(e.email),1),n("td",null,[l(L,{modelValue:e.role,"onUpdate:modelValue":i=>e.role=i,options:M,"map-options":"","emit-value":"",borderless:"",onInput:i=>E(e),debounce:"500"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),n("td",null,[e.latestMail?(u(),k("span",Ve,[p("Sent by "+d(e.invitee.fullname)+" "+d(b(pe)(e.latestMail.created_at)),1),$e,p(d(b(be)(e.latestMail.amazon_ses_status)),1)])):c("",!0)]),n("td",null,d(e.status),1),n("td",ye,[l(T,{icon:"more_vert",flat:""},{default:s(()=>[l(J,null,{default:s(()=>[l(B,null,{default:s(()=>[e.status==="Pending"?q((u(),g(V,{key:0,onClick:i=>te(e.id),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p(" Resend invitation ")]),_:1})]),_:2},1032,["onClick"])),[[j]]):c("",!0),q((u(),g(V,{onClick:i=>le(e.id),clickable:""},{default:s(()=>[l(w,null,{default:s(()=>[p(" Revoke invitation ")]),_:1})]),_:2},1032,["onClick"])),[[j]])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})):c("",!0)]),_:1}),l(O,null,{default:s(()=>[l(I,null,{default:s(()=>[Ce,n("p",null," Invite new "+d(a.$t("team.userPlural").toLowerCase())+" by filling out the form below and clicking SEND INVITE.",1)]),_:1}),l(I,null,{default:s(()=>[n("div",Ue,[n("div",Ie,[l(S,{modelValue:r.email,"onUpdate:modelValue":t[1]||(t[1]=e=>r.email=e),label:"Email address of user",error:b(C).email.$invalid},{append:s(()=>[l(T,{onClick:t[0]||(t[0]=e=>ae()),label:"Load",flat:"",color:"primary"})]),_:1},8,["modelValue","error"])]),n("div",Se,[l(S,{modelValue:r.first_name,"onUpdate:modelValue":t[2]||(t[2]=e=>r.first_name=e),label:"First name",error:b(C).first_name.$invalid,disable:o.value},null,8,["modelValue","error","disable"])]),n("div",xe,[l(S,{modelValue:r.last_name,"onUpdate:modelValue":t[3]||(t[3]=e=>r.last_name=e),label:"Last name",error:b(C).last_name.$invalid,disable:o.value},null,8,["modelValue","error","disable"])]),n("div",Qe,[l(L,{modelValue:r.role,"onUpdate:modelValue":t[4]||(t[4]=e=>r.role=e),label:"Customer Access",options:M,"map-options":"","emit-value":"",error:b(C).role.$invalid},null,8,["modelValue","error"])])]),n("div",Te,[l(ue,{modelValue:r.bypass,"onUpdate:modelValue":t[5]||(t[5]=e=>r.bypass=e),label:"Add directly and bypass invitation system",disable:""},null,8,["modelValue"]),l(ce),l(T,{onClick:t[6]||(t[6]=e=>ee()),disable:o.value||b(C).$invalid,label:"Send invite",color:"primary",loading:x.value},null,8,["disable","loading"])]),H.value?(u(),k("div",Ne,"This user already exists in the account.")):c("",!0)]),_:1})]),_:1})]))}}),Me={key:0},Ee={class:"text-h5"},Oe=n("p",null,"Users that are involved in this customer.",-1),et=z({__name:"TeamUsers",props:{model:null},setup(v){return(m,$)=>v.model.id?(u(),k("div",Me,[n("div",Ee,"Associated "+d(m.$t("team.userPlural")),1),Oe,l(Ae,{team:v.model},null,8,["team"])])):c("",!0)}});export{et as default};
