import{A as V,r as x,g as N,o as S,J as F,m as n,K as d,L as o,l as s,O as G,q as t,af as I,n as p,b7 as w,U as r,F as Q,b8 as a,y as c,S as L,R as h}from"./index.fbd59a76.js";import{Q as y,a as M}from"./QBreadcrumbs.18e816d5.js";import{Q as X}from"./QBadge.3656646d.js";import{a as v,Q as b}from"./QItemSection.e2ef8c04.js";import{Q as $}from"./QList.eaa15994.js";import{Q as E}from"./QMarkupTable.e4b2956c.js";import{Q as P}from"./QPage.c929a5d1.js";import{u as R}from"./use-quasar.1140b8ec.js";import{a as C}from"./axios.b71dd2ad.js";import{u as O}from"./debug.805a8aef.js";import{a as m,c as U,b as z,o as A}from"./help.24013814.js";const H={class:"row q-col-gutter-md"},J=t("div",{class:"col-xs-9"},[t("div",{class:"text-h4 q-mb-md"}," Commissions Owing ")],-1),K={class:"col-xs-3 text-right"},j=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Contractor"),t("th",{style:{width:"100px"},class:"text-left"},"Total"),t("th",{style:{width:"100px"},class:"text-left"},"GST"),t("th",{style:{width:"100px"},class:"text-left"},"Grand")])],-1),W=["onClick"],Y={key:0},Z={class:"bg-grey-2 text-bold"},tt=t("td",null,null,-1),et={key:1,class:"q-mt-md text-right"},ht=V({__name:"CommissionsOwing",setup(ot){const i=x(),_=R(),f=x(!0),q=()=>{_.loading.show({message:"Fetching commission data..."}),C.post("/user/contractor/reporting/commissionsowing").then(l=>{i.value=l.data,_.loading.hide()}).catch(l=>{O(l),_.loading.hide()})},k=N(()=>i.value&&i.value?f.value?i.value.data.filter(l=>l.commission.total>0):i.value.data:[]),T=l=>{l.showOrders=!l.showOrders},B=()=>{U("This will queue the Xero commissions batch push").onOk(()=>{C.post("/user/contractor/xero/queuecommissionbatch").then(()=>{z("positive","Commission batch queued for Xero processing")}).catch(l=>{O(l)})})};return S(()=>{q()}),(l,g)=>{const D=F("router-link");return n(),d(P,{padding:""},{default:o(()=>[s(M,{class:"q-mb-md q-mt-md"},{separator:o(()=>[s(G,{size:"1.5em",name:"chevron_right"})]),default:o(()=>[s(y,{label:"Home",icon:"home",to:{name:"appDashboard"}}),s(y,{label:"Reporting",to:{name:"reporting"}}),s(y,{label:"Commissions Owing"})]),_:1}),t("div",H,[J,t("div",K,[s(I,{modelValue:f.value,"onUpdate:modelValue":g[0]||(g[0]=e=>f.value=e),label:"Only show owing"},null,8,["modelValue"])])]),i.value?(n(),d(E,{key:0},{default:o(()=>[j,t("tbody",null,[(n(!0),p(Q,null,w(r(k),e=>(n(),p("tr",{key:e.id},[t("td",null,[t("a",{class:"link text-h6",onClick:u=>T(e)},[h(a(e.fullname)+" ",1),e.contractor_gst_registered?(n(),d(X,{key:0,label:"GST",color:"secondary"})):c("",!0)],8,W),e.showOrders?(n(),p("div",Y,[s($,{dense:""},{default:o(()=>[e.commission.orders.length?c("",!0):(n(),d(v,{key:0},{default:o(()=>[s(b,null,{default:o(()=>[h("No orders found")]),_:1})]),_:1})),(n(!0),p(Q,null,w(e.commission.orders,u=>(n(),d(v,{key:u.id},{default:o(()=>[s(b,null,{default:o(()=>[t("div",null,[s(D,{to:{name:"order-edit",params:{id:u.id}},class:"link",target:"_blank"},{default:o(()=>[h("#"+a(u.display_id),1)]),_:2},1032,["to"]),h(" - "+a(u.team)+" - "+a(r(A)(u.paid_date))+" - "+a(r(m)(u.commissionTotal)),1)])]),_:2},1024)]),_:2},1024))),128)),e.commission.penalty>0?(n(),d(v,{key:1,class:"text-negative"},{default:o(()=>[s(b,null,{default:o(()=>[h("Current Penalty: "+a(r(m)(e.commission.penalty)),1)]),_:2},1024)]),_:2},1024)):c("",!0)]),_:2},1024)])):c("",!0)]),t("td",null,a(r(m)(e.commission.total)),1),t("td",null,a(r(m)(e.commission.totalGst)),1),t("td",null,a(r(m)(e.commission.grandTotal)),1)]))),128))]),t("tfoot",null,[t("tr",Z,[tt,t("td",null,a(r(m)(i.value.total.total)),1),t("td",null,a(r(m)(i.value.total.gst)),1),t("td",null,a(r(m)(i.value.total.grand)),1)])])]),_:1})):c("",!0),r(k).length?(n(),p("div",et,[s(L,{onClick:g[1]||(g[1]=e=>B()),label:"Queue Xero push",color:"primary"})])):c("",!0)]),_:1})}}});export{ht as default};
