import{Q}from"./QSelect.853d535e.js";import{A as C,i as q,r as p,B,o as A,m as l,K as J,L as f,l as r,N as L,U as y,n,R as x,q as u,F as V,b7 as $,y as v,M as T,S as U,ae as D,Q as E,b8 as d}from"./index.e647c85a.js";import{u as F,r as N}from"./index.esm.4557c89b.js";import{a as k}from"./axios.ccd3a804.js";import{u as w}from"./debug.805a8aef.js";import{b as j}from"./help.c0f85e41.js";import{_ as I}from"./SmsLogComponent.e2a77b83.js";import"./QItemSection.99659658.js";import"./rtl.4f5e13e8.js";import"./format.8e90d58d.js";import"./QTable.64a81add.js";import"./QList.2f0afc60.js";import"./QMarkupTable.981d9979.js";import"./QLinearProgress.c48fac34.js";const K=u("div",{class:"text-h6 q-mb-md"},"Send SMS",-1),R={key:0,class:"q-pa-md"},z={key:1,class:"q-pa-md bg-positive text-white"},G=C({__name:"SendSmsOrder",props:{order:null},setup(m){const s=m,g=q("bus"),i=p([]),c=p(!1),b=p(),_={content:null,template:null,number:null,team_id:s.order.team_id,order_id:s.order.id},a=B(JSON.parse(JSON.stringify(_))),S=F({content:{required:N},team_id:{required:N}},a),h=p(),M=()=>{a.content=a.template},O=()=>{c.value=!0,k.post("/sms/sendorder",a).then(o=>{j("positive",`SMS sent to ${s.order.team.name}`),c.value=!1,i.value=o.data,g.emit("getSmsLog",{}),Object.assign(a,JSON.parse(JSON.stringify(_)))}).catch(o=>{w(o),c.value=!1})};return A(()=>{Object.assign(a,{content:null,template:null,number:null,team_id:s.order.team_id});const o=[];s.order&&s.order.team.users&&(s.order.team.users.forEach(e=>{e.mobile&&e.sms_notifications&&o.push(e)}),h.value=o),k.get("/smstemplate/index").then(e=>{b.value=e.data.map(t=>({value:t.content,label:t.name}))}).catch(e=>{w(e)})}),(o,e)=>(l(),J(E,null,{default:f(()=>[r(T,null,{default:f(()=>[K,r(Q,{modelValue:a.template,"onUpdate:modelValue":[e[0]||(e[0]=t=>a.template=t),e[1]||(e[1]=t=>M())],options:b.value,label:"Choose a Template","map-options":"","emit-value":"",class:"q-mb-md"},null,8,["modelValue","options"]),r(L,{modelValue:a.content,"onUpdate:modelValue":e[2]||(e[2]=t=>a.content=t),type:"textarea",maxlength:"160",label:"Message to send",error:y(S).content.$error,autogrow:""},null,8,["modelValue","error"]),!i.value||!i.value.length?(l(),n("div",R,[x(" A message will be sent to the following members: "),u("ul",null,[(l(!0),n(V,null,$(h.value,t=>(l(),n("li",{key:t.id},d(t.fullname)+" ("+d(t.mobile)+") ",1))),128))])])):v("",!0),i.value&&i.value.length?(l(),n("div",z,[x(" A message was sent to the following members: "),u("ul",null,[(l(!0),n(V,null,$(i.value,t=>(l(),n("li",{key:t.id},d(t.user.fullname)+" ("+d(t.user.mobile)+") ",1))),128))])])):v("",!0)]),_:1}),r(D,{align:"right"},{default:f(()=>[r(U,{color:"primary",disabled:y(S).$invalid,loading:c.value,onClick:e[3]||(e[3]=t=>O()),label:"Send"},null,8,["disabled","loading"])]),_:1})]),_:1}))}}),H={key:0},P=u("div",{class:"text-h6"},"SMS Activities",-1),ue=C({__name:"OrderSms",props:{model:null},setup(m){return(s,g)=>m.model.id?(l(),n("div",H,[P,u("p",null,"Send an SMS or view the history for this "+d(s.$t("team.name"))+".",1),r(G,{order:m.model,class:"q-mb-lg"},null,8,["order"]),r(I,{order_id:m.model.id},null,8,["order_id"])])):v("",!0)}});export{ue as default};
