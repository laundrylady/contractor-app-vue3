import{Q as M}from"./QSpace.2d911a61.js";import{A as x,r as p,B as S,i as T,o as D,E as O,m as v,K as w,L as a,l as e,Q as j,R as h,ai as B,G as y,S as _,ag as q,M as z,N as E,U as C,y as N,ae as H,aj as J,n as W,q as k,O as ae,F as te}from"./index.7da93179.js";import{Q as le,a as F}from"./QTable.01150601.js";import{a as I,Q as A}from"./QItem.642560fa.js";import{Q as se}from"./QList.709f4980.js";import{Q as ne}from"./QMenu.00781621.js";import{C as V}from"./ClosePopup.42f5b568.js";import{a as Q}from"./axios.07c7c7d9.js";import{_ as re}from"./PostcodeRegionDisplay.128d2d33.js";import{u as U}from"./debug.9f3fb657.js";import{d as X,o as K,r as ue,s as ie,a as de}from"./help.4068c5a1.js";import{Q as Y,a as Z}from"./QToolbarTitle.8a26e038.js";import{u as ee,r as L}from"./index.esm.0811bb15.js";import{a as ce}from"./geolocation.17ee4622.js";import{_ as oe}from"./PostcodeRegionMapField.33d88427.js";import"./QMarkupTable.f781861b.js";import"./QSelect.0342b451.js";import"./rtl.ba9e3bff.js";import"./format.3e32b8d9.js";import"./QLinearProgress.6e390987.js";import"./use-fullscreen.62410448.js";import"./QBadge.d2d220ed.js";const pe=x({__name:"UserPostcodeRegionGroupCreate",setup(P){const n=p(!1),m=p(),r=S({name:null,postcoderegions:null,user_id:null,approved:!0}),l=p(!1),c=p(),f=T("bus"),g=ee({name:{required:L},postcoderegions:{required:L}},r),$=()=>{Q.post("/userpostcoderegiongroup",r).then(()=>{X("positive","Group created"),f.emit("userPostcodeRegionGroupLoadMore"),Object.assign(r,{id:null,name:null,user_id:null}),n.value=!1,l.value=!1}).catch(u=>{U(u)})};return D(async()=>{f.on("newUserPostcodeRegionGroup",async u=>{c.value=await ce(),Object.assign(r,{name:null,postcoderegions:null,user_id:u.user_id}),m.value=u.state,n.value=!0})}),O(()=>{f.off("newUserPostcodeRegionGroup")}),(u,t)=>(v(),w(J,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value=o)},{default:a(()=>[e(j,{class:"modal-lg"},{default:a(()=>[e(Y,null,{default:a(()=>[e(Z,null,{default:a(()=>[h("New "+B(u.$t("postcodeRegionGroup.name")),1)]),_:1}),e(M),y(e(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),e(q),e(z,null,{default:a(()=>[e(E,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=o=>r.name=o),label:"Name of the group",error:C(g).name.$invalid},null,8,["modelValue","error"]),c.value?(v(),w(oe,{key:0,"lat-lng":c.value,modelValue:r.postcoderegions,"onUpdate:modelValue":t[1]||(t[1]=o=>r.postcoderegions=o),"show-map":!0,state:m.value},null,8,["lat-lng","modelValue","state"])):N("",!0)]),_:1}),e(H,{align:"right"},{default:a(()=>[y(e(_,{label:"Cancel",flat:"",color:"secondary"},null,512),[[V]]),e(_,{disable:l.value||C(g).$invalid,label:"Save",color:"primary",onClick:t[2]||(t[2]=o=>$())},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=x({__name:"UserPostcodeRegionGroupEdit",setup(P){const n=p(!1),m=p(),r=p(),l=S({id:null,name:null,postcoderegions:null,approved:!0}),c=p(!1),f=T("bus"),g=ee({name:{required:L},postcoderegions:{required:L}},l),$=()=>{Q.put(`/userpostcoderegiongroup/${l.id}`,l).then(()=>{X("positive","Group updated"),f.emit("userPostcodeRegionGroupLoadMore"),n.value=!1,c.value=!1}).catch(u=>{U(u)})};return D(()=>{f.on("editUserPostcodeRegionGroup",async u=>{m.value=u.state,Q.get(`/userpostcoderegiongroup/${u.id}`).then(t=>{Object.assign(l,t.data),l.postcoderegions&&l.postcoderegions[0]&&(r.value={lat:parseFloat(l.postcoderegions[0].meta.pivot_lat),lng:parseFloat(l.postcoderegions[0].meta.pivot_lng)}),n.value=!0}).catch(t=>{U(t)})})}),O(()=>{f.off("editUserPostcodeRegionGroup")}),(u,t)=>(v(),w(J,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value=o)},{default:a(()=>[l.name?(v(),w(j,{key:0,class:"modal-lg"},{default:a(()=>[e(Y,null,{default:a(()=>[e(Z,null,{default:a(()=>[h(B(l.name),1)]),_:1}),e(M),y(e(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),e(q),e(z,null,{default:a(()=>[e(E,{modelValue:l.name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.name=o),label:"Name of the group",error:C(g).name.$invalid},null,8,["modelValue","error"]),r.value?(v(),w(oe,{key:0,"lat-lng":r.value,modelValue:l.postcoderegions,"onUpdate:modelValue":t[1]||(t[1]=o=>l.postcoderegions=o),zoom:12,"show-map":!0},null,8,["lat-lng","modelValue"])):N("",!0)]),_:1}),e(H,{align:"right"},{default:a(()=>[y(e(_,{label:"Cancel",flat:"",color:"secondary"},null,512),[[V]]),e(_,{disable:c.value||C(g).$invalid,label:"Update",color:"primary",onClick:t[2]||(t[2]=o=>$())},null,8,["disable"])]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]))}}),ge={class:"flex items-center q-mb-sm"},fe=k("div",{class:"text-h5"},"Pickup Locations",-1),ve=["onClick"],_e={class:"q-mt-sm"},be=x({__name:"UserPostcodeRegionGroupManagement",props:{user:null},setup(P){const n=P,m=T("bus"),r=p(),l=p(!1),c=S({keyword:null}),f=[{name:"name",label:"Name",align:"left",field:"name",sortable:!0},{label:"Actions",name:"actions",sortable:!1,field:"actions"}],d=p({page:1,rowsNumber:K(),rowsPerPage:K(),sortBy:"name",descending:!1}),g=(o=null)=>{let i,s,b,R;o&&o.pagination?(i=o.pagination.page,s=o.pagination.rowsPerPage,b=o.pagination.sortBy,R=o.pagination.descending):(i=d.value.page,s=d.value.rowsPerPage,b=d.value.sortBy,R=d.value.descending),l.value=!0,Q.post(`/userpostcoderegiongroup/datatable/${i}/${n.user.id}`,{sortBy:b,sort_order:R?"desc":"asc",skip:i,rowsPerPage:s,keyword:c.keyword}).then(G=>{r.value=G.data.rows,l.value=!1,ie(s),d.value.rowsNumber=G.data.total,d.value.page=i,d.value.rowsPerPage=s,d.value.sortBy=b,d.value.descending=R}).catch(G=>{U(G)})},$=o=>{de("This will remove the postcode region group").onOk(()=>{Q.delete(`/userpostcoderegiongroup/${o}`).then(()=>{g()}).catch(i=>{U(i)})})},u=()=>{m.emit("newUserPostcodeRegionGroup",{user_id:n.user.id,state:n.user.postcoderegionsuburb?n.user.postcoderegionsuburb.state:null})},t=o=>{m.emit("editUserPostcodeRegionGroup",{id:o,state:n.user.postcoderegionsuburb?n.user.postcoderegionsuburb.state:null})};return D(()=>{m.on("userPostcodeRegionGroupLoadMore",()=>{g()}),g()}),O(()=>{m.off("userPostcodeRegionGroupLoadMore")}),(o,i)=>(v(),W(te,null,[e(pe),e(me),k("div",ge,[k("div",null,[fe,k("p",null,"Configure the pickup locations for this "+B(o.$t("contractor.name").toLowerCase())+".",1)]),e(M),e(_,{onClick:i[0]||(i[0]=s=>u()),icon:"add",color:"primary",round:""})]),e(j,null,{default:a(()=>[e(le,{rows:r.value,columns:f,"row-key":"id",filter:c.keyword,loading:l.value,pagination:d.value,"onUpdate:pagination":i[2]||(i[2]=s=>d.value=s),onRequest:g,flat:"","wrap-cells":"","rows-per-page-options":C(ue)},{"top-left":a(()=>[e(E,{modelValue:c.keyword,"onUpdate:modelValue":i[1]||(i[1]=s=>c.keyword=s),debounce:500,placeholder:"Keyword"},{append:a(()=>[e(ae,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-name":a(s=>[e(F,{props:s},{default:a(()=>[k("a",{onClick:b=>t(s.row.id),class:"link text-h6"},B(s.row.name),9,ve),k("div",_e,[e(re,{postcoderegions:s.row.postcoderegions},null,8,["postcoderegions"])])]),_:2},1032,["props"])]),"body-cell-actions":a(s=>[e(F,{props:s},{default:a(()=>[e(_,{flat:"",icon:"more_vert"},{default:a(()=>[e(ne,null,{default:a(()=>[e(se,null,{default:a(()=>[y((v(),w(A,{clickable:"",onClick:b=>t(s.row.id)},{default:a(()=>[e(I,null,{default:a(()=>[h("Edit record")]),_:1})]),_:2},1032,["onClick"])),[[V]]),y((v(),w(A,{clickable:"",onClick:b=>$(s.row.id)},{default:a(()=>[e(I,null,{default:a(()=>[h("Delete")]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})],64))}}),we={key:0},Fe=x({__name:"ContractorPostcodeRegionGroup",props:{model:null},setup(P){return(n,m)=>P.model.id?(v(),W("div",we,[e(be,{user:P.model},null,8,["user"])])):N("",!0)}});export{Fe as default};
