import{A as G,m as i,K as m,U as K,I as ee,r as b,B as ae,o as le,n as A,l as a,L as l,aD as te,F as L,M as se,q as o,O as k,R as p,b8 as g,y as V,G as P,S as M,b7 as oe,Q as O,t as ne,N as re}from"./index.fbd59a76.js";import{Q as z}from"./QSpace.8da48267.js";import{Q as $,a as x}from"./QItemSection.e2ef8c04.js";import{Q as E}from"./QList.eaa15994.js";import{a as ie,Q as N}from"./QBreadcrumbs.18e816d5.js";import{Q as j}from"./QSelect.5b5bbc87.js";import{Q as ue}from"./QHeader.de31cb0a.js";import{a as de,Q as f}from"./QTable.1191bda5.js";import{Q as me}from"./format.c926bd4b.js";import{Q as ce}from"./QPage.c929a5d1.js";import{Q as fe,a as be}from"./QLayout.8099c30b.js";import{C as B}from"./ClosePopup.117d0adb.js";import{a as y}from"./axios.b71dd2ad.js";import{F as pe,l as ge,x as F,z as _e,y as ve,c as D}from"./help.24013814.js";import{_ as H}from"./PostcodeRegionDisplay.44f67ec8.js";import{_ as he}from"./StatusTag.5e471305.js";import{_ as ke}from"./UserAvatar.a874c3dc.js";import{u as w}from"./debug.805a8aef.js";import{u as ye}from"./vue-i18n.runtime.esm-bundler.4ea63f02.js";import"./rtl.af167dee.js";import"./QResizeObserver.6ff9e290.js";import"./QMarkupTable.e4b2956c.js";import"./QLinearProgress.457e2dab.js";import"./QBadge.3656646d.js";const we=G({__name:"StateField",props:{modelValue:null,label:null,outlined:{type:Boolean},dense:{type:Boolean},disabled:{type:Boolean}},emits:["update:modelValue"],setup(_,{emit:q}){const v=h=>{q("update:modelValue",h)};return(h,S)=>(i(),m(j,{"model-value":_.modelValue,label:"State",style:{"min-width":"120px"},options:K(pe),outlined:_.outlined,dense:_.dense,disable:_.disabled,"onUpdate:modelValue":v,clearable:""},null,8,["model-value","options","outlined","dense","disable"]))}}),Qe={class:"flex items-start"},Ce={class:"text-h6"},Ve={class:"q-mt-xs"},Pe={class:"text-h6 q-mt-lg"},$e=o("p",null,"This user account has access to the following customer records.",-1),xe={class:"q-pl-md q-pt-sm q-pr-md q-pb-sm flex items-center",style:{"padding-top":"11px"}},Be={class:"text-h6"},qe=["onClick"],Se=["onClick"],la=G({__name:"UserManagement",setup(_){const q=ye(),v=ee(),h=b(),S=b(null),T=b(!1),u=b(),U=b(!1),n=ae({keyword:null,status:"active",role:null,state:null}),J=[{name:"avatar",label:"",align:"center",field:"avatar",sortable:!1,style:"width:65px"},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"first_name",label:"Name",align:"left",field:"first_name",sortable:!0},{name:"postcoderegionsuburb",sortable:!1,label:`Home ${q.t("address.suburb")}`,field:"postcoderegionsuburb",align:"left"},{name:"role",sortable:!0,label:"Type",field:"role",align:"left",format:t=>t?W[t]:""},{name:"current_sign_in_at",sortable:!0,label:"Last Signin",field:"current_sign_in_at",align:"left",format:t=>t?ge(t):""},{name:"enabled",sortable:!0,label:"Can Sign In",field:"enabled",align:"left"},{label:"Actions",name:"actions",sortable:!1,field:"actions"}],W={user:"Customer",contractor:"Contractor",admin:"Staff"},r=b({page:1,rowsNumber:F(),rowsPerPage:F(),sortBy:"first_name",descending:!1}),c=(t=null)=>{let s,e,d,Q;t&&t.pagination?(s=t.pagination.page,e=t.pagination.rowsPerPage,d=t.pagination.sortBy,Q=t.pagination.descending):(s=r.value.page,e=r.value.rowsPerPage,d=r.value.sortBy,Q=r.value.descending),T.value=!0,y.post(`/user/datatable/${s}`,{sortBy:d,sort_order:Q?"desc":"asc",skip:s,rowsPerPage:e,keyword:n.keyword,status:n.status,role:n.role,state:n.state}).then(C=>{var I;h.value=C.data.rows,T.value=!1,_e(e),r.value.rowsNumber=C.data.total,r.value.page=s,r.value.rowsPerPage=e,r.value.sortBy=d,r.value.descending=Q,t&&((I=S.value)==null||I.scrollIntoView({behavior:"smooth",block:"center"}))}).catch(C=>{w(C)})},X=t=>{D("This will remove the user permenantly").onOk(()=>{y.delete(`/user/${t}`).then(()=>{c(null)}).catch(s=>{w(s)})})},Y=t=>{t.enabled?D("This will disable access for this user").onOk(()=>{y.get(`/user/toggleenabled/${t.id}/0`).then(()=>{c(null)}).catch(s=>{w(s)})}):D("This will enable access for this user").onOk(()=>{y.get(`/user/toggleenabled/${t.id}/1`).then(()=>{c(null)}).catch(s=>{w(s)})})},R=t=>{t.role==="user"&&v.push({name:"team-dashboard",params:{id:t.current_team_id}}),t.role==="contractor"&&v.push({name:"contractor-dashboard",params:{id:t.id}}),t.role==="admin"&&window.open("https://myaccount.google.com/")},Z=t=>{if(t.role==="contractor"){v.push({name:"contractor-dashboard",params:{id:t.id}});return}y.get(`/teamuser/teamsbyuserid/${t.id}`).then(s=>{u.value={user:t,teams:s.data},U.value=!0}).catch(s=>w(s))};return le(()=>{c()}),(t,s)=>(i(),A(L,null,[a(te,{modelValue:U.value,"onUpdate:modelValue":s[0]||(s[0]=e=>U.value=e)},{default:l(()=>[u.value&&u.value.user?(i(),m(O,{key:0,class:"modal-sm"},{default:l(()=>[a(se,null,{default:l(()=>[o("div",Qe,[o("div",null,[o("div",Ce,[a(k,{name:u.value.role==="contractor"?"engineering":"group",class:"q-mr-sm"},null,8,["name"]),p(g(u.value.user.fullname),1)]),o("div",null,g(u.value.user.email),1),o("div",Ve,[u.value.user.postcoderegionsuburb?(i(),m(H,{key:0,postcoderegions:[u.value.user.postcoderegionsuburb]},null,8,["postcoderegions"])):V("",!0)])]),a(z),P(a(M,{dense:"",round:"",icon:"close",flat:""},null,512),[[B]])]),o("div",Pe,[a(k,{name:"security",class:"q-mr-sm"}),p(" Record Access")]),$e,a(E,{separator:"",dense:"",bordered:""},{default:l(()=>[(i(!0),A(L,null,oe(u.value.teams,e=>(i(),m(x,{key:e.id,to:{name:"team-dashboard",params:{id:e.id}},clickable:""},{default:l(()=>[a($,{class:"link"},{default:l(()=>[p(g(e.name),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1},8,["modelValue"]),a(fe,{view:"lHh LpR fFf",container:"",class:"layout-height"},{default:l(()=>[a(ue,{class:ne({"page-title text-black":!t.$q.dark.isActive,"bg-dark":t.$q.dark.isActive}),bordered:""},{default:l(()=>[o("div",xe,[a(ie,null,{separator:l(()=>[a(k,{size:"1.5em",name:"chevron_right"})]),default:l(()=>[a(N,{label:"Home",icon:"home",to:{name:"appDashboard"}}),a(N,{label:"Settings",to:{name:"settings"}}),a(N,{label:"Users"})]),_:1}),a(re,{modelValue:n.keyword,"onUpdate:modelValue":s[1]||(s[1]=e=>n.keyword=e),debounce:500,placeholder:"Search users",dense:"",borderless:"",class:"q-ml-lg",clearable:""},{prepend:l(()=>[a(k,{name:"search"})]),_:1},8,["modelValue"]),a(z),a(j,{modelValue:n.role,"onUpdate:modelValue":[s[2]||(s[2]=e=>n.role=e),s[3]||(s[3]=e=>c(null))],label:"Type",options:[{label:"Contractor",value:"contractor"},{label:"Customer",value:"user"},{label:"Staff",value:"admin"}],"map-options":"","emit-value":"",outlined:"",dense:"",class:"q-mr-sm",style:{width:"150px"}},null,8,["modelValue"]),a(we,{modelValue:n.state,"onUpdate:modelValue":[s[4]||(s[4]=e=>n.state=e),s[5]||(s[5]=e=>c(null))],label:"State",outlined:!0,dense:!0},null,8,["modelValue"])])]),_:1},8,["class"]),a(be,null,{default:l(()=>[a(ce,{padding:""},{default:l(()=>[o("div",{ref_key:"topRef",ref:S},null,512),a(O,null,{default:l(()=>[a(de,{rows:h.value,columns:J,"row-key":"id",filter:n.keyword,loading:T.value,pagination:r.value,"onUpdate:pagination":s[6]||(s[6]=e=>r.value=e),onRequest:c,class:"no-shadow","rows-per-page-options":K(ve)},{"body-cell-avatar":l(e=>[a(f,{props:e},{default:l(()=>[a(ke,{user:e.row},null,8,["user"])]),_:2},1032,["props"])]),"body-cell-email":l(e=>[a(f,{props:e},{default:l(()=>[o("div",Be,[o("a",{class:"link",onClick:d=>Z(e.row)},g(e.row.email),9,qe)])]),_:2},1032,["props"])]),"body-cell-first_name":l(e=>[a(f,{props:e},{default:l(()=>[o("a",{onClick:d=>R(e.row),class:"link"},g(e.row.fullname),9,Se)]),_:2},1032,["props"])]),"body-cell-contractor_status":l(e=>[a(f,{props:e},{default:l(()=>[a(he,{status:e.row.contractor_status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-postcoderegionsuburb":l(e=>[a(f,{props:e},{default:l(()=>[e.row.postcoderegionsuburb?(i(),m(H,{key:0,postcoderegions:[e.row.postcoderegionsuburb]},null,8,["postcoderegions"])):V("",!0)]),_:2},1032,["props"])]),"body-cell-enabled":l(e=>[a(f,{props:e},{default:l(()=>[e.row.enabled?(i(),m(k,{key:0,name:"check",size:"24px"})):V("",!0)]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[a(f,{props:e},{default:l(()=>[a(M,{flat:"",icon:"more_vert"},{default:l(()=>[a(me,null,{default:l(()=>[a(E,null,{default:l(()=>[P((i(),m(x,{clickable:"",onClick:d=>Y(e.row)},{default:l(()=>[a($,null,{default:l(()=>[p(g(`${e.row.enabled?"Disable":"Enable"}`),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[B]]),P((i(),m(x,{clickable:"",onClick:d=>R(e.row)},{default:l(()=>[a($,null,{default:l(()=>[p("Edit record")]),_:1})]),_:2},1032,["onClick"])),[[B]]),P((i(),m(x,{clickable:"",onClick:d=>X(e.row.id)},{default:l(()=>[a($,null,{default:l(()=>[p("Delete")]),_:1})]),_:2},1032,["onClick"])),[[B]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination","rows-per-page-options"])]),_:1})]),_:1})]),_:1})]),_:1})],64))}});export{la as default};
